<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pukar Bhandari">
<meta name="dcterms.date" content="2025-10-14">
<meta name="description" content="This notebook replicates the analysis from the ’_archive/_Source - Med Income &amp; Value of Time - 2022-08-09.xlsb’ using the Utah Household Data. The values of time are segmented by occupancy and purpose (work vs.&nbsp;personal).">

<title>Value of Time Estimation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-0b716d6fe31096b8dc5b1cb48462c79f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/bootstrap/bootstrap-dark-7c823468029c3b379f9b90e418026680.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="index_files/libs/bootstrap/bootstrap-0b716d6fe31096b8dc5b1cb48462c79f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Value of Time Estimation</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Estimating the Value of Time Parameter for Utah’s Travel Demand Model</p>
                  <div>
        <div class="description">
          This notebook replicates the analysis from the ’_archive/_Source - Med Income &amp; Value of Time - 2022-08-09.xlsb’ using the Utah Household Data. The values of time are segmented by occupancy and purpose (work vs.&nbsp;personal).
        </div>
      </div>
                </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Pukar Bhandari <a href="mailto:pukar.bhandari@wfrc.utah.gov" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://wfrc.utah.gov/">
              Wasatch Front Regional Council
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 14, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#environment-setup" id="toc-environment-setup" class="nav-link" data-scroll-target="#environment-setup"><span class="header-section-number">2</span> Environment Setup</a>
  <ul class="collapse">
  <li><a href="#install-required-packages" id="toc-install-required-packages" class="nav-link" data-scroll-target="#install-required-packages">Install Required Packages</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load Libraries</a></li>
  <li><a href="#environment-variables" id="toc-environment-variables" class="nav-link" data-scroll-target="#environment-variables">Environment Variables</a></li>
  </ul></li>
  <li><a href="#define-helper-functions" id="toc-define-helper-functions" class="nav-link" data-scroll-target="#define-helper-functions"><span class="header-section-number">3</span> Define Helper Functions</a>
  <ul class="collapse">
  <li><a href="#fetch-excel-files-from-bls-or-bts" id="toc-fetch-excel-files-from-bls-or-bts" class="nav-link" data-scroll-target="#fetch-excel-files-from-bls-or-bts">Fetch Excel Files from BLS or BTS</a></li>
  </ul></li>
  <li><a href="#lookup-tables" id="toc-lookup-tables" class="nav-link" data-scroll-target="#lookup-tables"><span class="header-section-number">4</span> Lookup Tables</a>
  <ul class="collapse">
  <li><a href="#income-category-lookup" id="toc-income-category-lookup" class="nav-link" data-scroll-target="#income-category-lookup">Income Category Lookup</a></li>
  </ul></li>
  <li><a href="#raw-data-sources" id="toc-raw-data-sources" class="nav-link" data-scroll-target="#raw-data-sources"><span class="header-section-number">5</span> Raw Data Sources</a>
  <ul class="collapse">
  <li><a href="#consumer-price-index" id="toc-consumer-price-index" class="nav-link" data-scroll-target="#consumer-price-index">Consumer Price Index</a></li>
  <li><a href="#american-community-survey-acs-5-year-estimates" id="toc-american-community-survey-acs-5-year-estimates" class="nav-link" data-scroll-target="#american-community-survey-acs-5-year-estimates">American Community Survey (ACS) 5-Year Estimates</a></li>
  </ul></li>
  <li><a href="#intermediate-calculations" id="toc-intermediate-calculations" class="nav-link" data-scroll-target="#intermediate-calculations"><span class="header-section-number">6</span> Intermediate Calculations</a>
  <ul class="collapse">
  <li><a href="#income-groupings-approximate-income-quartiles" id="toc-income-groupings-approximate-income-quartiles" class="nav-link" data-scroll-target="#income-groupings-approximate-income-quartiles">Income Groupings (Approximate Income Quartiles)</a></li>
  <li><a href="#median-income-in-model-base-year-dollars" id="toc-median-income-in-model-base-year-dollars" class="nav-link" data-scroll-target="#median-income-in-model-base-year-dollars">Median Income (in Model Base Year Dollars)</a></li>
  <li><a href="#value-of-time-in-model-base-year-dollars" id="toc-value-of-time-in-model-base-year-dollars" class="nav-link" data-scroll-target="#value-of-time-in-model-base-year-dollars">Value of Time (in Model Base Year Dollars)</a></li>
  </ul></li>
  <li><a href="#export-results" id="toc-export-results" class="nav-link" data-scroll-target="#export-results"><span class="header-section-number">7</span> Export Results</a>
  <ul class="collapse">
  <li><a href="#create-final-vot-table" id="toc-create-final-vot-table" class="nav-link" data-scroll-target="#create-final-vot-table">Create Final VOT Table</a></li>
  <li><a href="#export-to-csv" id="toc-export-to-csv" class="nav-link" data-scroll-target="#export-to-csv">Export to CSV</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">






<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
</section>
<section id="environment-setup" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="environment-setup"><span class="header-section-number">2</span> Environment Setup</h2>
<section id="install-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="install-required-packages">Install Required Packages</h3>
<p>Install the necessary Python packages for data processing, spatial analysis, and visualization. This includes pandas for data manipulation, geopandas for spatial operations, pygris for accessing Census TIGER/Line shapefiles, and various visualization libraries.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>conda install <span class="op">-</span>c conda<span class="op">-</span>forge numpy pandas geopandas matplotlib seaborn python<span class="op">-</span>dotenv openpyxl</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install pygris adjustText</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">Load Libraries</h3>
<p>Import all required libraries for the analysis. The pygris library enables direct access to Census Bureau geographic data and ACS estimates through their API.</p>
<div id="666d0cd7" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Analysis</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For Visualization</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> adjustText <span class="im">import</span> adjust_text</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Census data query libraries &amp; modules</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygris <span class="im">import</span> blocks, block_groups, counties, states</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygris.helpers <span class="im">import</span> validate_state, validate_county</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygris.data <span class="im">import</span> get_census</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># misc</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>False</code></pre>
</div>
</div>
</section>
<section id="environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="environment-variables">Environment Variables</h3>
<p>Set the coordinate reference system for the analysis to NAD83 / UTM zone 12N (EPSG:3566), which is appropriate for Utah. Also validate the state FIPS code for Utah.</p>
<div id="de345d2e" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>PROJECT_CRS <span class="op">=</span> <span class="st">"EPSG:3566"</span>  <span class="co"># NAD83 / UTM zone 12N</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>STATE_FIPS <span class="op">=</span> validate_state(<span class="st">"UT"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Using FIPS code '49' for input 'UT'</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Need a Census API key?</strong> Get one for free at <a href="https://api.census.gov/data/key_signup.html">census.gov/developers</a>.</p>
<p>Create a <code>.env</code> file in the project directory and add your Census API key: <code>CENSUS_API_KEY=your-key-here</code> This enables fetching US Census data from the Census API.</p>
</div>
</div>
<div id="20c4068d" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your API key into environment (alternative to .env file)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'CENSUS_API_KEY'</span>] <span class="op">=</span> <span class="st">'your_api_key_here'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="define-helper-functions" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="define-helper-functions"><span class="header-section-number">3</span> Define Helper Functions</h2>
<section id="fetch-excel-files-from-bls-or-bts" class="level3">
<h3 class="anchored" data-anchor-id="fetch-excel-files-from-bls-or-bts">Fetch Excel Files from BLS or BTS</h3>
<div id="a4c7e92a" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_excel(path, url):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Download Excel file if it doesn't exist locally.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    path : str or Path</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Local file path to save the Excel file</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">    url : str</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">        URL to download the Excel file from</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to Path object if string</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    filepath <span class="op">=</span> Path(path)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Download file if it doesn't exist</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> filepath.exists():</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        filepath.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        headers <span class="op">=</span> {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.get(url, headers<span class="op">=</span>headers)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        filepath.write_bytes(response.content)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="lookup-tables" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="lookup-tables"><span class="header-section-number">4</span> Lookup Tables</h2>
<section id="income-category-lookup" class="level3">
<h3 class="anchored" data-anchor-id="income-category-lookup">Income Category Lookup</h3>
<p>Create a reference table defining the income brackets used in ACS Table B19001. Each bracket has a lower and upper limit, and we calculate midpoints for median estimation. The highest bracket ($200,000+) uses $300,000 as a reasonable midpoint based on income distribution patterns.</p>
<div id="5d1302fc" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lookup_hhinc <span class="op">=</span> pd.DataFrame({</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Income Category"</span>: [</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HH_LT_10K"</span>, <span class="st">"HH_10_15K"</span>, <span class="st">"HH_15_20K"</span>, <span class="st">"HH_20_25K"</span>, <span class="st">"HH_25_30K"</span>, <span class="st">"HH_30_35K"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HH_35_40K"</span>, <span class="st">"HH_40_45K"</span>, <span class="st">"HH_45_50K"</span>, <span class="st">"HH_50_60K"</span>, <span class="st">"HH_60_75K"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HH_75_100K"</span>, <span class="st">"HH_100_125K"</span>, <span class="st">"HH_125_150K"</span>, <span class="st">"HH_150_200K"</span>, <span class="st">"HH_GT_200K"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lower Limit"</span>: [</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">15000</span>, <span class="dv">20000</span>, <span class="dv">25000</span>, <span class="dv">30000</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">35000</span>, <span class="dv">40000</span>, <span class="dv">45000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">75000</span>, <span class="dv">100000</span>, <span class="dv">125000</span>, <span class="dv">150000</span>, <span class="dv">200000</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Upper Limit"</span>: [</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">9999</span>, <span class="dv">14999</span>, <span class="dv">19999</span>, <span class="dv">24999</span>, <span class="dv">29999</span>, <span class="dv">34999</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="dv">39999</span>, <span class="dv">44999</span>, <span class="dv">49999</span>, <span class="dv">59999</span>, <span class="dv">74999</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">99999</span>, <span class="dv">124999</span>, <span class="dv">149999</span>, <span class="dv">199999</span>, np.inf</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute midpoint and round it</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>lookup_hhinc[<span class="st">'Midpoint'</span>] <span class="op">=</span> (</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  (lookup_hhinc[<span class="st">'Lower Limit'</span>] <span class="op">+</span> lookup_hhinc[<span class="st">'Upper Limit'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>()</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace infinite midpoint (last category) with 300000</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>lookup_hhinc.loc[np.isinf(lookup_hhinc[<span class="st">"Upper Limit"</span>]), <span class="st">"Midpoint"</span>] <span class="op">=</span> <span class="dv">300000</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>lookup_hhinc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Income Category</th>
<th data-quarto-table-cell-role="th">Lower Limit</th>
<th data-quarto-table-cell-role="th">Upper Limit</th>
<th data-quarto-table-cell-role="th">Midpoint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>HH_LT_10K</td>
<td>0</td>
<td>9999.0</td>
<td>5000.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>HH_10_15K</td>
<td>10000</td>
<td>14999.0</td>
<td>12500.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>HH_15_20K</td>
<td>15000</td>
<td>19999.0</td>
<td>17500.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>HH_20_25K</td>
<td>20000</td>
<td>24999.0</td>
<td>22500.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>HH_25_30K</td>
<td>25000</td>
<td>29999.0</td>
<td>27500.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>HH_30_35K</td>
<td>30000</td>
<td>34999.0</td>
<td>32500.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>HH_35_40K</td>
<td>35000</td>
<td>39999.0</td>
<td>37500.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>HH_40_45K</td>
<td>40000</td>
<td>44999.0</td>
<td>42500.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>HH_45_50K</td>
<td>45000</td>
<td>49999.0</td>
<td>47500.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>HH_50_60K</td>
<td>50000</td>
<td>59999.0</td>
<td>55000.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>HH_60_75K</td>
<td>60000</td>
<td>74999.0</td>
<td>67500.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>HH_75_100K</td>
<td>75000</td>
<td>99999.0</td>
<td>87500.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>HH_100_125K</td>
<td>100000</td>
<td>124999.0</td>
<td>112500.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>HH_125_150K</td>
<td>125000</td>
<td>149999.0</td>
<td>137500.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>HH_150_200K</td>
<td>150000</td>
<td>199999.0</td>
<td>175000.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>HH_GT_200K</td>
<td>200000</td>
<td>inf</td>
<td>300000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="raw-data-sources" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="raw-data-sources"><span class="header-section-number">5</span> Raw Data Sources</h2>
<section id="consumer-price-index" class="level3">
<h3 class="anchored" data-anchor-id="consumer-price-index">Consumer Price Index</h3>
<p>The Consumer Price Index (CPI-U-RS) from the Bureau of Labor Statistics provides inflation adjustment factors. This will be useful for comparing income values across different time periods or adjusting historical data to current dollars. The research series (R-CPI-U-RS) is particularly appropriate for longitudinal analysis as it uses consistent methodology throughout the time series.</p>
<p>Download and load the CPI data directly from the BLS website. The data includes annual average CPI values that can be used to adjust income figures for inflation.</p>
<p>Data Source: Consumer Price Index for All Urban Consumers (CPI-U) [Source: <a href="https://www.bls.gov/cpi/research-series/r-cpi-u-rs-home.htm">Bureau of Labor Statistics</a>]</p>
<div id="32b04840" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>filepath_cpi <span class="op">=</span> Path(<span class="st">"_data/bls/r-cpi-u-rs-allitems.xlsx"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>url_cpi <span class="op">=</span> <span class="st">"https://www.bls.gov/cpi/research-series/r-cpi-u-rs-allitems.xlsx"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Download if needed</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>fetch_excel(path<span class="op">=</span>filepath_cpi, url<span class="op">=</span>url_cpi)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Read separately</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>df_CPI <span class="op">=</span> pd.read_excel(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    filepath_cpi,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    sheet_name<span class="op">=</span><span class="st">"All items"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    usecols<span class="op">=</span><span class="st">"A:N"</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    skiprows<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    engine<span class="op">=</span><span class="st">'openpyxl'</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>df_CPI</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">JAN</th>
<th data-quarto-table-cell-role="th">FEB</th>
<th data-quarto-table-cell-role="th">MAR</th>
<th data-quarto-table-cell-role="th">APR</th>
<th data-quarto-table-cell-role="th">MAY</th>
<th data-quarto-table-cell-role="th">JUNE</th>
<th data-quarto-table-cell-role="th">JULY</th>
<th data-quarto-table-cell-role="th">AUG</th>
<th data-quarto-table-cell-role="th">SEP</th>
<th data-quarto-table-cell-role="th">OCT</th>
<th data-quarto-table-cell-role="th">NOV</th>
<th data-quarto-table-cell-role="th">DEC</th>
<th data-quarto-table-cell-role="th">AVG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1977</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>100.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1978</td>
<td>100.5</td>
<td>101.1</td>
<td>101.8</td>
<td>102.7</td>
<td>103.6</td>
<td>104.5</td>
<td>105.0</td>
<td>105.5</td>
<td>106.1</td>
<td>106.7</td>
<td>107.3</td>
<td>107.8</td>
<td>104.4</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1979</td>
<td>108.7</td>
<td>109.7</td>
<td>110.7</td>
<td>111.8</td>
<td>113.0</td>
<td>114.1</td>
<td>115.1</td>
<td>116.0</td>
<td>117.1</td>
<td>117.9</td>
<td>118.5</td>
<td>119.5</td>
<td>114.3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1980</td>
<td>120.8</td>
<td>122.4</td>
<td>123.8</td>
<td>124.7</td>
<td>125.7</td>
<td>126.7</td>
<td>127.5</td>
<td>128.6</td>
<td>129.9</td>
<td>130.7</td>
<td>131.5</td>
<td>132.4</td>
<td>127.1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1981</td>
<td>133.6</td>
<td>135.2</td>
<td>136.3</td>
<td>137.1</td>
<td>137.9</td>
<td>138.7</td>
<td>139.7</td>
<td>140.7</td>
<td>141.8</td>
<td>142.4</td>
<td>142.9</td>
<td>143.4</td>
<td>139.1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>1982</td>
<td>144.2</td>
<td>144.7</td>
<td>144.9</td>
<td>145.0</td>
<td>146.1</td>
<td>147.5</td>
<td>148.5</td>
<td>148.8</td>
<td>149.5</td>
<td>150.2</td>
<td>150.5</td>
<td>150.6</td>
<td>147.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>1983</td>
<td>151.0</td>
<td>151.1</td>
<td>151.2</td>
<td>152.4</td>
<td>153.2</td>
<td>153.7</td>
<td>154.3</td>
<td>154.8</td>
<td>155.6</td>
<td>156.0</td>
<td>156.1</td>
<td>156.3</td>
<td>153.8</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1984</td>
<td>157.2</td>
<td>158.0</td>
<td>158.3</td>
<td>159.0</td>
<td>159.5</td>
<td>159.9</td>
<td>160.4</td>
<td>161.1</td>
<td>161.8</td>
<td>162.2</td>
<td>162.2</td>
<td>162.3</td>
<td>160.2</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>1985</td>
<td>162.5</td>
<td>163.2</td>
<td>163.9</td>
<td>164.6</td>
<td>165.2</td>
<td>165.6</td>
<td>165.9</td>
<td>166.2</td>
<td>166.8</td>
<td>167.2</td>
<td>167.7</td>
<td>168.1</td>
<td>165.6</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1986</td>
<td>168.6</td>
<td>168.1</td>
<td>167.3</td>
<td>166.9</td>
<td>167.4</td>
<td>168.2</td>
<td>168.2</td>
<td>168.5</td>
<td>169.4</td>
<td>169.5</td>
<td>169.5</td>
<td>169.6</td>
<td>168.4</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>1987</td>
<td>170.6</td>
<td>171.3</td>
<td>172.0</td>
<td>172.9</td>
<td>173.4</td>
<td>174.0</td>
<td>174.3</td>
<td>175.3</td>
<td>176.1</td>
<td>176.5</td>
<td>176.6</td>
<td>176.5</td>
<td>174.1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>1988</td>
<td>177.0</td>
<td>177.3</td>
<td>178.0</td>
<td>178.9</td>
<td>179.5</td>
<td>180.1</td>
<td>180.8</td>
<td>181.6</td>
<td>182.7</td>
<td>183.2</td>
<td>183.3</td>
<td>183.4</td>
<td>180.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>1989</td>
<td>184.3</td>
<td>184.9</td>
<td>185.9</td>
<td>187.2</td>
<td>188.1</td>
<td>188.5</td>
<td>189.0</td>
<td>189.2</td>
<td>189.8</td>
<td>190.6</td>
<td>190.9</td>
<td>191.1</td>
<td>188.3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1990</td>
<td>193.0</td>
<td>193.9</td>
<td>194.9</td>
<td>195.2</td>
<td>195.5</td>
<td>196.5</td>
<td>197.3</td>
<td>199.0</td>
<td>200.6</td>
<td>201.7</td>
<td>202.0</td>
<td>202.0</td>
<td>197.6</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>1991</td>
<td>202.9</td>
<td>203.1</td>
<td>203.3</td>
<td>203.5</td>
<td>204.1</td>
<td>204.5</td>
<td>204.7</td>
<td>205.2</td>
<td>206.1</td>
<td>206.2</td>
<td>206.7</td>
<td>206.8</td>
<td>204.8</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1992</td>
<td>207.2</td>
<td>207.7</td>
<td>208.6</td>
<td>209.0</td>
<td>209.3</td>
<td>209.7</td>
<td>210.1</td>
<td>210.6</td>
<td>211.2</td>
<td>211.8</td>
<td>212.1</td>
<td>211.9</td>
<td>209.9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>1993</td>
<td>212.6</td>
<td>213.3</td>
<td>214.0</td>
<td>214.5</td>
<td>215.0</td>
<td>215.2</td>
<td>215.3</td>
<td>215.7</td>
<td>216.0</td>
<td>216.7</td>
<td>216.9</td>
<td>216.7</td>
<td>215.2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>1994</td>
<td>217.1</td>
<td>217.6</td>
<td>218.4</td>
<td>218.6</td>
<td>218.9</td>
<td>219.5</td>
<td>220.0</td>
<td>220.7</td>
<td>221.1</td>
<td>221.2</td>
<td>221.5</td>
<td>221.4</td>
<td>219.7</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1995</td>
<td>222.2</td>
<td>222.9</td>
<td>223.6</td>
<td>224.3</td>
<td>224.7</td>
<td>225.2</td>
<td>225.3</td>
<td>225.7</td>
<td>226.1</td>
<td>226.7</td>
<td>226.5</td>
<td>226.4</td>
<td>225.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>1996</td>
<td>227.5</td>
<td>228.3</td>
<td>229.4</td>
<td>230.2</td>
<td>230.8</td>
<td>230.9</td>
<td>231.3</td>
<td>231.5</td>
<td>232.3</td>
<td>233.0</td>
<td>233.4</td>
<td>233.4</td>
<td>231.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>1997</td>
<td>234.1</td>
<td>234.7</td>
<td>235.2</td>
<td>235.5</td>
<td>235.4</td>
<td>235.8</td>
<td>235.9</td>
<td>236.3</td>
<td>237.1</td>
<td>237.5</td>
<td>237.4</td>
<td>237.0</td>
<td>236.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1998</td>
<td>237.4</td>
<td>237.8</td>
<td>238.1</td>
<td>238.6</td>
<td>239.0</td>
<td>239.1</td>
<td>239.4</td>
<td>239.7</td>
<td>240.0</td>
<td>240.5</td>
<td>240.5</td>
<td>240.3</td>
<td>239.2</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>1999</td>
<td>240.9</td>
<td>241.2</td>
<td>241.9</td>
<td>243.6</td>
<td>243.6</td>
<td>243.7</td>
<td>244.4</td>
<td>245.1</td>
<td>246.2</td>
<td>246.7</td>
<td>246.8</td>
<td>246.8</td>
<td>244.2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>2000</td>
<td>247.6</td>
<td>249.1</td>
<td>251.1</td>
<td>251.2</td>
<td>251.4</td>
<td>252.9</td>
<td>253.4</td>
<td>253.4</td>
<td>254.8</td>
<td>255.1</td>
<td>255.3</td>
<td>255.1</td>
<td>252.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>2001</td>
<td>256.8</td>
<td>257.9</td>
<td>258.5</td>
<td>259.5</td>
<td>260.5</td>
<td>261.1</td>
<td>260.3</td>
<td>260.4</td>
<td>261.4</td>
<td>260.6</td>
<td>260.1</td>
<td>259.1</td>
<td>259.7</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>2002</td>
<td>259.8</td>
<td>260.8</td>
<td>262.2</td>
<td>263.7</td>
<td>263.6</td>
<td>263.9</td>
<td>264.1</td>
<td>265.0</td>
<td>265.4</td>
<td>265.9</td>
<td>265.9</td>
<td>265.3</td>
<td>263.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>2003</td>
<td>266.4</td>
<td>268.6</td>
<td>270.2</td>
<td>269.5</td>
<td>269.1</td>
<td>269.5</td>
<td>269.7</td>
<td>270.7</td>
<td>271.6</td>
<td>271.4</td>
<td>270.6</td>
<td>270.3</td>
<td>269.8</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>2004</td>
<td>271.7</td>
<td>273.2</td>
<td>274.9</td>
<td>275.8</td>
<td>277.3</td>
<td>278.2</td>
<td>277.8</td>
<td>277.9</td>
<td>278.5</td>
<td>280.0</td>
<td>280.2</td>
<td>279.1</td>
<td>277.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>2005</td>
<td>279.6</td>
<td>281.3</td>
<td>283.5</td>
<td>285.4</td>
<td>285.2</td>
<td>285.2</td>
<td>286.5</td>
<td>288.0</td>
<td>291.5</td>
<td>292.2</td>
<td>289.8</td>
<td>288.6</td>
<td>286.4</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>2006</td>
<td>290.8</td>
<td>291.4</td>
<td>293.1</td>
<td>295.5</td>
<td>296.9</td>
<td>297.6</td>
<td>298.4</td>
<td>299.1</td>
<td>297.6</td>
<td>296.0</td>
<td>295.6</td>
<td>296.0</td>
<td>295.7</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>2007</td>
<td>296.9</td>
<td>298.5</td>
<td>301.2</td>
<td>303.1</td>
<td>305.0</td>
<td>305.6</td>
<td>305.5</td>
<td>304.9</td>
<td>305.8</td>
<td>306.4</td>
<td>308.3</td>
<td>308.1</td>
<td>304.1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>2008</td>
<td>309.6</td>
<td>310.5</td>
<td>313.2</td>
<td>315.1</td>
<td>317.7</td>
<td>320.9</td>
<td>322.6</td>
<td>321.3</td>
<td>320.9</td>
<td>317.6</td>
<td>311.6</td>
<td>308.3</td>
<td>315.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>2009</td>
<td>309.7</td>
<td>311.2</td>
<td>312.0</td>
<td>312.8</td>
<td>313.7</td>
<td>316.4</td>
<td>315.8</td>
<td>316.6</td>
<td>316.8</td>
<td>317.1</td>
<td>317.3</td>
<td>316.7</td>
<td>314.7</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>2010</td>
<td>317.8</td>
<td>317.9</td>
<td>319.2</td>
<td>319.8</td>
<td>320.0</td>
<td>319.7</td>
<td>319.8</td>
<td>320.2</td>
<td>320.4</td>
<td>320.8</td>
<td>320.9</td>
<td>321.5</td>
<td>319.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>2011</td>
<td>323.0</td>
<td>324.6</td>
<td>327.8</td>
<td>329.9</td>
<td>331.5</td>
<td>331.1</td>
<td>331.4</td>
<td>332.3</td>
<td>332.8</td>
<td>332.2</td>
<td>331.9</td>
<td>331.1</td>
<td>330.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>2012</td>
<td>332.6</td>
<td>334.0</td>
<td>336.6</td>
<td>337.6</td>
<td>337.2</td>
<td>336.7</td>
<td>336.2</td>
<td>338.1</td>
<td>339.6</td>
<td>339.5</td>
<td>337.9</td>
<td>337.0</td>
<td>336.9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>2013</td>
<td>338.0</td>
<td>340.8</td>
<td>341.7</td>
<td>341.3</td>
<td>341.9</td>
<td>342.8</td>
<td>342.9</td>
<td>343.3</td>
<td>343.8</td>
<td>342.9</td>
<td>342.2</td>
<td>342.2</td>
<td>342.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>2014</td>
<td>343.5</td>
<td>344.8</td>
<td>347.0</td>
<td>348.2</td>
<td>349.4</td>
<td>350.1</td>
<td>349.9</td>
<td>349.3</td>
<td>349.6</td>
<td>348.7</td>
<td>346.9</td>
<td>344.9</td>
<td>347.7</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>2015</td>
<td>343.4</td>
<td>344.9</td>
<td>346.9</td>
<td>347.7</td>
<td>349.4</td>
<td>350.7</td>
<td>350.7</td>
<td>350.2</td>
<td>349.7</td>
<td>349.5</td>
<td>348.8</td>
<td>347.6</td>
<td>348.3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>2016</td>
<td>348.2</td>
<td>348.5</td>
<td>350.0</td>
<td>351.7</td>
<td>353.1</td>
<td>354.2</td>
<td>353.7</td>
<td>354.0</td>
<td>354.8</td>
<td>355.3</td>
<td>354.7</td>
<td>354.9</td>
<td>352.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>2017</td>
<td>356.9</td>
<td>358.0</td>
<td>358.3</td>
<td>359.4</td>
<td>359.7</td>
<td>360.0</td>
<td>359.8</td>
<td>360.9</td>
<td>362.8</td>
<td>362.5</td>
<td>362.6</td>
<td>362.3</td>
<td>360.3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>2018</td>
<td>364.3</td>
<td>366.0</td>
<td>366.7</td>
<td>368.3</td>
<td>369.8</td>
<td>370.3</td>
<td>370.4</td>
<td>370.7</td>
<td>371.1</td>
<td>371.8</td>
<td>370.6</td>
<td>369.3</td>
<td>369.1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>2019</td>
<td>370.0</td>
<td>371.5</td>
<td>373.6</td>
<td>375.6</td>
<td>376.4</td>
<td>376.5</td>
<td>377.2</td>
<td>377.1</td>
<td>377.5</td>
<td>378.4</td>
<td>378.2</td>
<td>377.8</td>
<td>375.8</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>2020</td>
<td>379.2</td>
<td>380.2</td>
<td>379.5</td>
<td>377.2</td>
<td>377.2</td>
<td>379.4</td>
<td>381.3</td>
<td>382.6</td>
<td>383.1</td>
<td>383.2</td>
<td>382.9</td>
<td>383.2</td>
<td>380.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>2021</td>
<td>384.9</td>
<td>387.1</td>
<td>390.0</td>
<td>393.2</td>
<td>396.7</td>
<td>400.5</td>
<td>402.4</td>
<td>403.1</td>
<td>404.2</td>
<td>407.6</td>
<td>409.5</td>
<td>410.8</td>
<td>399.2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>2022</td>
<td>414.3</td>
<td>418.2</td>
<td>423.9</td>
<td>426.3</td>
<td>431.0</td>
<td>436.9</td>
<td>436.8</td>
<td>436.7</td>
<td>437.6</td>
<td>439.4</td>
<td>439.0</td>
<td>437.6</td>
<td>431.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>2023</td>
<td>441.1</td>
<td>443.6</td>
<td>445.0</td>
<td>447.3</td>
<td>448.4</td>
<td>449.9</td>
<td>450.7</td>
<td>452.7</td>
<td>453.8</td>
<td>453.6</td>
<td>452.7</td>
<td>452.3</td>
<td>449.3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>2024</td>
<td>454.7</td>
<td>457.6</td>
<td>460.5</td>
<td>462.3</td>
<td>463.1</td>
<td>463.2</td>
<td>463.8</td>
<td>464.1</td>
<td>464.9</td>
<td>465.4</td>
<td>465.2</td>
<td>465.3</td>
<td>462.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="american-community-survey-acs-5-year-estimates" class="level3">
<h3 class="anchored" data-anchor-id="american-community-survey-acs-5-year-estimates">American Community Survey (ACS) 5-Year Estimates</h3>
<section id="define-census-variables" class="level4">
<h4 class="anchored" data-anchor-id="define-census-variables">Define Census Variables</h4>
<p>Define the specific ACS variables we need for this analysis. Table B19013 provides median household income, while Table B19001 provides the household income distribution across 16 income brackets. These brackets allow us to calculate weighted averages and estimate medians when direct values are unavailable.</p>
<div id="ba0b898e" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define variables to download</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>acs_variables <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19013_001E'</span>: <span class="st">'HH_MED_INC'</span>,  <span class="co"># Median Household Income in the Past 12 Months (in 2023 Inflation-Adjusted Dollars)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19013_001M'</span>: <span class="st">'HH_MED_INC_MOE'</span>,  <span class="co"># Margin of Error for Median Household Income</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_001E'</span>: <span class="st">'HH_TOTAL'</span>,  <span class="co"># Total Households</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_002E'</span>: <span class="st">'HH_LT_10K'</span>,  <span class="co"># Less than $10,000</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_003E'</span>: <span class="st">'HH_10_15K'</span>,  <span class="co"># $10,000 to $14,999</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_004E'</span>: <span class="st">'HH_15_20K'</span>,  <span class="co"># $15,000 to $19,999</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_005E'</span>: <span class="st">'HH_20_25K'</span>,  <span class="co"># $20,000 to $24,999</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_006E'</span>: <span class="st">'HH_25_30K'</span>,  <span class="co"># $25,000 to $29,999</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_007E'</span>: <span class="st">'HH_30_35K'</span>,  <span class="co"># $30,000 to $34,999</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_008E'</span>: <span class="st">'HH_35_40K'</span>,  <span class="co"># $35,000 to $39,999</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_009E'</span>: <span class="st">'HH_40_45K'</span>,  <span class="co"># $40,000 to $44,999</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_010E'</span>: <span class="st">'HH_45_50K'</span>,  <span class="co"># $45,000 to $49,999</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_011E'</span>: <span class="st">'HH_50_60K'</span>,  <span class="co"># $50,000 to $59,999</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_012E'</span>: <span class="st">'HH_60_75K'</span>,  <span class="co"># $60,000 to $74,999</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_013E'</span>: <span class="st">'HH_75_100K'</span>,  <span class="co"># $75,000 to $99,999</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_014E'</span>: <span class="st">'HH_100_125K'</span>,  <span class="co"># $100,000 to $124,999</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_015E'</span>: <span class="st">'HH_125_150K'</span>,  <span class="co"># $125,000 to $149,999</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_016E'</span>: <span class="st">'HH_150_200K'</span>,  <span class="co"># $150,000 to $199,999</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_017E'</span>: <span class="st">'HH_GT_200K'</span>  <span class="co"># $200,000 or more</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="state-level-data" class="level4">
<h4 class="anchored" data-anchor-id="state-level-data">State Level Data</h4>
<p>Retrieve state-level income data for Utah. While we’ll primarily use smaller geographies, state-level data provides a useful benchmark for comparison and validation.</p>
<div id="15203f5d" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch state boundaries from TIGER/Line shapefiles</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>gdf_ut_bound <span class="op">=</span> states(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  year<span class="op">=</span><span class="dv">2023</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  cache<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>).to_crs(PROJECT_CRS)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Utah only</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>gdf_ut_bound <span class="op">=</span> gdf_ut_bound[gdf_ut_bound[<span class="st">'STATEFP'</span>] <span class="op">==</span> <span class="bu">str</span>(STATE_FIPS)]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Income data from ACS 5-year estimates for Utah</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>df_ut_income <span class="op">=</span> get_census(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  dataset<span class="op">=</span><span class="st">"acs/acs5"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  year<span class="op">=</span><span class="dv">2023</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  variables<span class="op">=</span><span class="bu">list</span>(acs_variables.keys()),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  params<span class="op">=</span>{</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># "key": f"{os.getenv('CENSUS_API_KEY')}", # </span><span class="al">FIXME</span><span class="co">: This causes error</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"for"</span>: <span class="ss">f"state:</span><span class="sc">{</span>STATE_FIPS<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    return_geoid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    guess_dtypes<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Join ACS data to block group boundaries and transform CRS</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>gdf_ut_income <span class="op">=</span> gdf_ut_bound[[<span class="st">'GEOID'</span>, <span class="st">'STATEFP'</span>, <span class="st">'NAME'</span>, <span class="st">'geometry'</span>]].merge(</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    df_ut_income, on <span class="op">=</span> <span class="st">"GEOID"</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>).to_crs(PROJECT_CRS).rename(columns<span class="op">=</span>acs_variables)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview data</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>gdf_ut_income</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">GEOID</th>
<th data-quarto-table-cell-role="th">STATEFP</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">HH_MED_INC</th>
<th data-quarto-table-cell-role="th">HH_MED_INC_MOE</th>
<th data-quarto-table-cell-role="th">HH_TOTAL</th>
<th data-quarto-table-cell-role="th">HH_LT_10K</th>
<th data-quarto-table-cell-role="th">HH_10_15K</th>
<th data-quarto-table-cell-role="th">HH_15_20K</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">HH_35_40K</th>
<th data-quarto-table-cell-role="th">HH_40_45K</th>
<th data-quarto-table-cell-role="th">HH_45_50K</th>
<th data-quarto-table-cell-role="th">HH_50_60K</th>
<th data-quarto-table-cell-role="th">HH_60_75K</th>
<th data-quarto-table-cell-role="th">HH_75_100K</th>
<th data-quarto-table-cell-role="th">HH_100_125K</th>
<th data-quarto-table-cell-role="th">HH_125_150K</th>
<th data-quarto-table-cell-role="th">HH_150_200K</th>
<th data-quarto-table-cell-role="th">HH_GT_200K</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>49</td>
<td>49</td>
<td>Utah</td>
<td>POLYGON ((900313.399 6302435.171, 900580.099 6...</td>
<td>91750</td>
<td>634</td>
<td>1094896</td>
<td>33918</td>
<td>22999</td>
<td>22352</td>
<td>...</td>
<td>33072</td>
<td>32113</td>
<td>35150</td>
<td>69627</td>
<td>104883</td>
<td>159368</td>
<td>134089</td>
<td>102926</td>
<td>124090</td>
<td>137560</td>
</tr>
</tbody>
</table>

<p>1 rows × 23 columns</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="intermediate-calculations" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="intermediate-calculations"><span class="header-section-number">6</span> Intermediate Calculations</h2>
<section id="income-groupings-approximate-income-quartiles" class="level3">
<h3 class="anchored" data-anchor-id="income-groupings-approximate-income-quartiles">Income Groupings (Approximate Income Quartiles)</h3>
<div id="b1cb105e" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of lookup table to work with</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_inc_group <span class="op">=</span> lookup_hhinc.copy()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the income category columns from gdf_ut_income</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract just the income bracket counts (excluding totals and medians)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>income_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> gdf_ut_income.columns <span class="cf">if</span> col.startswith(<span class="st">'HH_'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>               <span class="kw">and</span> col <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'HH_TOTAL'</span>, <span class="st">'HH_MED_INC'</span>, <span class="st">'HH_MED_INC_MOE'</span>]]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping between lookup categories and gdf_ut_income columns</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># They should already match, but let's be explicit</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'State HH'</span>] <span class="op">=</span> df_inc_group[<span class="st">'Income Category'</span>].<span class="bu">map</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    gdf_ut_income[income_cols].iloc[<span class="dv">0</span>].to_dict()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage of households</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>total_hh <span class="op">=</span> df_inc_group[<span class="st">'State HH'</span>].<span class="bu">sum</span>()</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'% HH'</span>] <span class="op">=</span> (df_inc_group[<span class="st">'State HH'</span>] <span class="op">/</span> total_hh <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative percentage</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'Cum % HH'</span>] <span class="op">=</span> df_inc_group[<span class="st">'% HH'</span>].cumsum().<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign income groups based on quartiles (25%, 50%, 75%, 100%)</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'Inc Group'</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    df_inc_group[<span class="st">'Cum % HH'</span>],</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>],</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Inc Group 1'</span>, <span class="st">'Inc Group 2'</span>, <span class="st">'Inc Group 3'</span>, <span class="st">'Inc Group 4'</span>],</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    include_lowest<span class="op">=</span><span class="va">True</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate HH_MedInc_Product (HH * Midpoint)</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'HH_MedInc_Product'</span>] <span class="op">=</span> df_inc_group[<span class="st">'State HH'</span>] <span class="op">*</span> df_inc_group[<span class="st">'Midpoint'</span>]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the dataframe</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>df_inc_group</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Income Category</th>
<th data-quarto-table-cell-role="th">Lower Limit</th>
<th data-quarto-table-cell-role="th">Upper Limit</th>
<th data-quarto-table-cell-role="th">Midpoint</th>
<th data-quarto-table-cell-role="th">State HH</th>
<th data-quarto-table-cell-role="th">% HH</th>
<th data-quarto-table-cell-role="th">Cum % HH</th>
<th data-quarto-table-cell-role="th">Inc Group</th>
<th data-quarto-table-cell-role="th">HH_MedInc_Product</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>HH_LT_10K</td>
<td>0</td>
<td>9999.0</td>
<td>5000.0</td>
<td>33918</td>
<td>3.1</td>
<td>3.1</td>
<td>Inc Group 1</td>
<td>1.695900e+08</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>HH_10_15K</td>
<td>10000</td>
<td>14999.0</td>
<td>12500.0</td>
<td>22999</td>
<td>2.1</td>
<td>5.2</td>
<td>Inc Group 1</td>
<td>2.874875e+08</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>HH_15_20K</td>
<td>15000</td>
<td>19999.0</td>
<td>17500.0</td>
<td>22352</td>
<td>2.0</td>
<td>7.2</td>
<td>Inc Group 1</td>
<td>3.911600e+08</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>HH_20_25K</td>
<td>20000</td>
<td>24999.0</td>
<td>22500.0</td>
<td>24376</td>
<td>2.2</td>
<td>9.4</td>
<td>Inc Group 1</td>
<td>5.484600e+08</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>HH_25_30K</td>
<td>25000</td>
<td>29999.0</td>
<td>27500.0</td>
<td>28040</td>
<td>2.6</td>
<td>12.0</td>
<td>Inc Group 1</td>
<td>7.711000e+08</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>HH_30_35K</td>
<td>30000</td>
<td>34999.0</td>
<td>32500.0</td>
<td>30333</td>
<td>2.8</td>
<td>14.8</td>
<td>Inc Group 1</td>
<td>9.858225e+08</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>HH_35_40K</td>
<td>35000</td>
<td>39999.0</td>
<td>37500.0</td>
<td>33072</td>
<td>3.0</td>
<td>17.8</td>
<td>Inc Group 1</td>
<td>1.240200e+09</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>HH_40_45K</td>
<td>40000</td>
<td>44999.0</td>
<td>42500.0</td>
<td>32113</td>
<td>2.9</td>
<td>20.7</td>
<td>Inc Group 1</td>
<td>1.364802e+09</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>HH_45_50K</td>
<td>45000</td>
<td>49999.0</td>
<td>47500.0</td>
<td>35150</td>
<td>3.2</td>
<td>23.9</td>
<td>Inc Group 1</td>
<td>1.669625e+09</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>HH_50_60K</td>
<td>50000</td>
<td>59999.0</td>
<td>55000.0</td>
<td>69627</td>
<td>6.4</td>
<td>30.3</td>
<td>Inc Group 2</td>
<td>3.829485e+09</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>HH_60_75K</td>
<td>60000</td>
<td>74999.0</td>
<td>67500.0</td>
<td>104883</td>
<td>9.6</td>
<td>39.9</td>
<td>Inc Group 2</td>
<td>7.079602e+09</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>HH_75_100K</td>
<td>75000</td>
<td>99999.0</td>
<td>87500.0</td>
<td>159368</td>
<td>14.6</td>
<td>54.5</td>
<td>Inc Group 3</td>
<td>1.394470e+10</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>HH_100_125K</td>
<td>100000</td>
<td>124999.0</td>
<td>112500.0</td>
<td>134089</td>
<td>12.2</td>
<td>66.7</td>
<td>Inc Group 3</td>
<td>1.508501e+10</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>HH_125_150K</td>
<td>125000</td>
<td>149999.0</td>
<td>137500.0</td>
<td>102926</td>
<td>9.4</td>
<td>76.1</td>
<td>Inc Group 4</td>
<td>1.415232e+10</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>HH_150_200K</td>
<td>150000</td>
<td>199999.0</td>
<td>175000.0</td>
<td>124090</td>
<td>11.3</td>
<td>87.4</td>
<td>Inc Group 4</td>
<td>2.171575e+10</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>HH_GT_200K</td>
<td>200000</td>
<td>inf</td>
<td>300000.0</td>
<td>137560</td>
<td>12.6</td>
<td>100.0</td>
<td>Inc Group 4</td>
<td>4.126800e+10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="20494f1a" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for seaborn</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_plot <span class="op">=</span> df_inc_group.copy()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_plot[<span class="st">'Income Label'</span>] <span class="op">=</span> df_plot[<span class="st">'Income Category'</span>].<span class="bu">str</span>.replace(<span class="st">'HH_'</span>, <span class="st">''</span>).<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df_plot[<span class="st">'index'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(df_plot))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for each income group</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">'Inc Group 1'</span>: <span class="st">'#3498db'</span>, <span class="st">'Inc Group 2'</span>: <span class="st">'#2ecc71'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Inc Group 3'</span>: <span class="st">'#f39c12'</span>, <span class="st">'Inc Group 4'</span>: <span class="st">'#e74c3c'</span>}</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seaborn style and context</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"notebook"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create barplot using seaborn</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_plot,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'index'</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'State HH'</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Inc Group'</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>palette,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    dodge<span class="op">=</span><span class="va">False</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Income Category'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Households'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Utah Household Income Distribution by Quartile'</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Format y-axis with comma separator</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>plt.gca().yaxis.set_major_formatter(ticker.FuncFormatter(<span class="kw">lambda</span> x, p: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span>))</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis labels</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(df_plot)), df_plot[<span class="st">'Income Label'</span>],</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>           rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize legend</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, frameon<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">10</span>, title<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid styling</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>plt.gca().set_axisbelow(<span class="va">True</span>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for cleaner look</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/cell-11-output-1.png" width="1137" height="564" class="figure-img"></p>
<figcaption>Household Income Distribution by Quartile</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="median-income-in-model-base-year-dollars" class="level3">
<h3 class="anchored" data-anchor-id="median-income-in-model-base-year-dollars">Median Income (in Model Base Year Dollars)</h3>
<div id="12e32a12" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define income categories</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Average'</span>: df_inc_group,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Low Inc'</span>: df_inc_group[df_inc_group[<span class="st">'Inc Group'</span>] <span class="op">==</span> <span class="st">'Inc Group 1'</span>],</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'High Inc'</span>: df_inc_group[df_inc_group[<span class="st">'Inc Group'</span>] <span class="op">!=</span> <span class="st">'Inc Group 1'</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics for each category</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> {}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_name, cat_df <span class="kw">in</span> categories.items():</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name] <span class="op">=</span> {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Sum HH'</span>: cat_df[<span class="st">'State HH'</span>].<span class="bu">sum</span>(),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Sum HH * Inc'</span>: cat_df[<span class="st">'HH_MedInc_Product'</span>].<span class="bu">sum</span>(),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate unadjusted median income</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name][<span class="st">'Unadj Med Inc'</span>] <span class="op">=</span> (</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        summary_data[cat_name][<span class="st">'Sum HH * Inc'</span>] <span class="op">/</span> summary_data[cat_name][<span class="st">'Sum HH'</span>]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correction factor from Average category</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>actual_median_income <span class="op">=</span> gdf_ut_income[<span class="st">'HH_MED_INC'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>correction_factor <span class="op">=</span> actual_median_income <span class="op">/</span> summary_data[<span class="st">'Average'</span>][<span class="st">'Unadj Med Inc'</span>]</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>inflation_factor <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply correction and inflation factors</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_name <span class="kw">in</span> summary_data:</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summary_data[cat_name]['Correction Factor'] = correction_factor</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name][<span class="st">'Adj Med Income'</span>] <span class="op">=</span> (</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        summary_data[cat_name][<span class="st">'Unadj Med Inc'</span>] <span class="op">*</span> correction_factor</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summary_data[cat_name]['Inflation Adj Factor'] = inflation_factor</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name][<span class="st">'Median Income'</span>] <span class="op">=</span> (</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>        summary_data[cat_name][<span class="st">'Adj Med Income'</span>] <span class="op">*</span> inflation_factor</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> pd.DataFrame(summary_data).T</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for display</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>format_specs <span class="op">=</span> {</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sum HH'</span>: <span class="st">'</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sum HH * Inc'</span>: <span class="st">'</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Unadj Med Inc'</span>: <span class="st">'$</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 'Correction Factor': '{:.4f}',</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Adj Med Income'</span>: <span class="st">'$</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 'Inflation Adj Factor': '{:.4f}',</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Median Income'</span>: <span class="st">'$</span><span class="sc">{:,.0f}</span><span class="st">'</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>df_median_income <span class="op">=</span> df_summary.copy()</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, fmt <span class="kw">in</span> format_specs.items():</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    df_median_income[col] <span class="op">=</span> df_summary[col].<span class="bu">apply</span>(<span class="kw">lambda</span> x: fmt.<span class="bu">format</span>(x))</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>df_median_income</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sum HH</th>
<th data-quarto-table-cell-role="th">Sum HH * Inc</th>
<th data-quarto-table-cell-role="th">Unadj Med Inc</th>
<th data-quarto-table-cell-role="th">Adj Med Income</th>
<th data-quarto-table-cell-role="th">Median Income</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Average</th>
<td>1,094,896</td>
<td>124,503,122,500</td>
<td>$113,712</td>
<td>$91,750</td>
<td>$91,750</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Low Inc</th>
<td>262,353</td>
<td>7,428,247,500</td>
<td>$28,314</td>
<td>$22,845</td>
<td>$22,845</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">High Inc</th>
<td>832,543</td>
<td>117,074,875,000</td>
<td>$140,623</td>
<td>$113,463</td>
<td>$113,463</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="value-of-time-in-model-base-year-dollars" class="level3">
<h3 class="anchored" data-anchor-id="value-of-time-in-model-base-year-dollars">Value of Time (in Model Base Year Dollars)</h3>
<section id="calculate-hourly-income" class="level4">
<h4 class="anchored" data-anchor-id="calculate-hourly-income">Calculate Hourly Income</h4>
<div id="3fddd320" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract median incomes and calculate hourly rates</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>median_income <span class="op">=</span> df_summary.loc[[<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>], <span class="st">'Median Income'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>median_income_hr <span class="op">=</span> median_income <span class="op">/</span> <span class="dv">2080</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"HOURLY INCOME &amp; ESTIMATED WAGE RATE"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df_hourly_display <span class="op">=</span> pd.DataFrame({</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    cat: [<span class="ss">f"$</span><span class="sc">{</span>median_income[cat]<span class="sc">:,.0f}</span><span class="ss">"</span>, <span class="ss">f"$</span><span class="sc">{</span>median_income_hr[cat]<span class="sc">:.2f}</span><span class="ss">"</span>]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">'Median Income'</span>, <span class="st">'Median Income ($/hr)'</span>])</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_hourly_display.to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
HOURLY INCOME &amp; ESTIMATED WAGE RATE
================================================================================
                      Average  Low Inc  High Inc
Median Income         $91,750  $22,845  $113,463
Median Income ($/hr)   $44.11   $10.98    $54.55</code></pre>
</div>
</div>
</section>
<section id="setup-vot-calculation-helper" class="level4">
<h4 class="anchored" data-anchor-id="setup-vot-calculation-helper">Setup VOT Calculation Helper</h4>
<div id="03980d27" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hardcoded VOT percentages from previous calculations</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>vot_percentages <span class="op">=</span> pd.DataFrame({</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Work'</span>: [<span class="fl">0.39</span>, <span class="fl">0.62</span>, <span class="fl">0.34</span>],</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Personal'</span>: [<span class="fl">0.30</span>, <span class="fl">0.49</span>, <span class="fl">0.27</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to calculate VOT metrics</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_vot(hourly_rate, percentage):</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate VOT metrics: unrounded rate, VOT cents/min, equivalent rate"""</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    unrounded_hr <span class="op">=</span> hourly_rate <span class="op">*</span> percentage</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    vot_cents <span class="op">=</span> <span class="bu">round</span>(unrounded_hr <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="dv">60</span>, <span class="dv">0</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    equiv_hr <span class="op">=</span> vot_cents <span class="op">*</span> <span class="dv">60</span> <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unrounded_hr, vot_cents, equiv_hr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="calculate-and-display-work-personal-vot" class="level4">
<h4 class="anchored" data-anchor-id="calculate-and-display-work-personal-vot">Calculate and Display Work &amp; Personal VOT</h4>
<div id="52a17731" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate all VOT metrics</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>vot_results <span class="op">=</span> {}</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip_type <span class="kw">in</span> [<span class="st">'Work'</span>, <span class="st">'Personal'</span>]:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    vot_results[trip_type] <span class="op">=</span> {}</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> income_cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        pct <span class="op">=</span> vot_percentages.loc[income_cat, trip_type]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        vot_results[trip_type][income_cat] <span class="op">=</span> calculate_vot(median_income_hr[income_cat], pct)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display Work &amp; Personal VOT</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"WORK &amp; PERSONAL VALUE OF TIME"</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip_type <span class="kw">in</span> [<span class="st">'Work'</span>, <span class="st">'Personal'</span>]:</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    rows.extend([</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'% of Med Income - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"</span><span class="sc">{</span>vot_percentages<span class="sc">.</span>loc[cat, trip_type]<span class="sc">:.0%}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}},</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'Unrounded Hr Rate - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss"> ($/hr)'</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"$</span><span class="sc">{</span>vot_results[trip_type][cat][<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}},</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'Value of Time - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss"> (cent/min)'</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"</span><span class="sc">{</span>vot_results[trip_type][cat][<span class="dv">1</span>]<span class="sc">:.0f}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}},</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'Equiv Hr Rate - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss"> ($/hr)'</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"$</span><span class="sc">{</span>vot_results[trip_type][cat][<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}}</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> trip_type <span class="op">==</span> <span class="st">'Work'</span>:</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">'Metric'</span>: <span class="st">''</span>, <span class="st">'Average'</span>: <span class="st">''</span>, <span class="st">'Low Inc'</span>: <span class="st">''</span>, <span class="st">'High Inc'</span>: <span class="st">''</span>})</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(rows).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
WORK &amp; PERSONAL VALUE OF TIME
================================================================================
                             Metric Average Low Inc High Inc
             % of Med Income - Work     39%     62%      34%
    Unrounded Hr Rate - Work ($/hr)  $17.20   $6.81   $18.55
    Value of Time - Work (cent/min)      29      11       31
        Equiv Hr Rate - Work ($/hr)  $17.40   $6.60   $18.60
                                                            
         % of Med Income - Personal     30%     49%      27%
Unrounded Hr Rate - Personal ($/hr)  $13.23   $5.38   $14.73
Value of Time - Personal (cent/min)      22       9       25
    Equiv Hr Rate - Personal ($/hr)  $13.20   $5.40   $15.00</code></pre>
</div>
</div>
</section>
<section id="calculate-and-display-truck-vot" class="level4">
<h4 class="anchored" data-anchor-id="calculate-and-display-truck-vot">Calculate and Display Truck VOT</h4>
<div id="b4239e5b" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Truck VOT</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TRUCK VALUE OF TIME"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>truck_config <span class="op">=</span> [(<span class="st">'Light'</span>, <span class="fl">0.65</span>), (<span class="st">'Medium'</span>, <span class="fl">0.87</span>), (<span class="st">'Heavy'</span>, <span class="fl">1.10</span>)]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>truck_rows <span class="op">=</span> []</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> truck_type, pct <span class="kw">in</span> truck_config:</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    unrounded, vot, equiv <span class="op">=</span> calculate_vot(median_income_hr[<span class="st">'Average'</span>], pct)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    truck_rows.append({</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Type'</span>: truck_type,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="sc">% o</span><span class="st">f Inc'</span>: <span class="ss">f"</span><span class="sc">{</span>pct<span class="sc">:.0%}</span><span class="ss">"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Hr Rate ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>unrounded<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: <span class="ss">f"</span><span class="sc">{</span>vot<span class="sc">:.0f}</span><span class="ss">"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Equiv Hr Rate ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>equiv<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(truck_rows).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
TRUCK VALUE OF TIME
================================================================================
  Type % of Inc Hr Rate ($/hr) VOT (cent/min) Equiv Hr Rate ($/hr)
 Light      65%         $28.67             48               $28.80
Medium      87%         $38.38             64               $38.40
 Heavy     110%         $48.52             81               $48.60</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="export-results" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="export-results"><span class="header-section-number">7</span> Export Results</h2>
<section id="create-final-vot-table" class="level3">
<h3 class="anchored" data-anchor-id="create-final-vot-table">Create Final VOT Table</h3>
<div id="6f6fb0f8" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract VOT summary table</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>vot_summary <span class="op">=</span> []</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Work and Personal - Average</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>vot_summary.extend([</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Wrk'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>],</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Per'</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>],</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Ext'</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: <span class="bu">round</span>((vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>] <span class="op">+</span> vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span>),</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>(vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>] <span class="op">+</span> vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span><span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Truck VOT</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> truck_type, pct <span class="kw">in</span> [(<span class="st">'LT'</span>, <span class="fl">0.65</span>), (<span class="st">'MD'</span>, <span class="fl">0.87</span>), (<span class="st">'HV'</span>, <span class="fl">1.10</span>)]:</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    _, vot, equiv <span class="op">=</span> calculate_vot(median_income_hr[<span class="st">'Average'</span>], pct)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    vot_summary.append({</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="ss">f'VOT_</span><span class="sc">{</span>truck_type<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>equiv<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Work and Personal - Low Income</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>vot_summary.extend([</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Wrk_Lo'</span>,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Work'</span>][<span class="st">'Low Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Work'</span>][<span class="st">'Low Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Per_Lo'</span>,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Personal'</span>][<span class="st">'Low Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Personal'</span>][<span class="st">'Low Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Work and Personal - High Income</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>vot_summary.extend([</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Wrk_Hi'</span>,</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Work'</span>][<span class="st">'High Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Work'</span>][<span class="st">'High Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Per_Hi'</span>,</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Personal'</span>][<span class="st">'High Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Personal'</span>][<span class="st">'High Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and display final VOT table</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>df_vot_final <span class="op">=</span> pd.DataFrame(vot_summary)</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VALUE OF TIME PARAMETERS"</span>)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_vot_final.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
VALUE OF TIME PARAMETERS
============================================================
      Parameter  VOT (cent/min) VOT ($/hr)
   VOT_Auto_Wrk            29.0      $17.4
   VOT_Auto_Per            22.0      $13.2
   VOT_Auto_Ext            26.0      $15.3
         VOT_LT            48.0      $28.8
         VOT_MD            64.0      $38.4
         VOT_HV            81.0      $48.6
VOT_Auto_Wrk_Lo            11.0       $6.6
VOT_Auto_Per_Lo             9.0       $5.4
VOT_Auto_Wrk_Hi            31.0      $18.6
VOT_Auto_Per_Hi            25.0      $15.0</code></pre>
</div>
</div>
</section>
<section id="export-to-csv" class="level3">
<h3 class="anchored" data-anchor-id="export-to-csv">Export to CSV</h3>
<div id="0913f2bd" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> Path(<span class="st">"_output"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>output_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to CSV</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>df_vot_final.to_csv(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    output_dir <span class="op">/</span> <span class="st">"value_of_time.csv"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="va">False</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Download the output files:">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Download the output files:
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="./_output/value_of_time.csv">value_of_time.csv</a></p>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Value of Time Estimation</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Estimating the Value of Time Parameter for Utah's Travel Demand Model</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> This notebook replicates the analysis from the '_archive/_Source - Med Income &amp; Value of Time - 2022-08-09.xlsb' using the Utah Household Data. The values of time are segmented by occupancy and purpose (work vs. personal).</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Pukar Bhandari</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">   email: pukar.bhandari@wfrc.utah.gov</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliation:</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">     - name: Wasatch Front Regional Council</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">       url: "https://wfrc.utah.gov/"</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-10-14"</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">   eval: true</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">        light: flatly</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">        dark: darkly</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">    respect-user-color-scheme: true</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 8.4</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 5.44</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-responsive: true</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="co">    # fig-width: 8</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="co">    # fig-height: 5</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co">    # out-width: "100%"</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="co">    # fig-align: center</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co">    resources:</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="co">        - "_output/*.csv"</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> true</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## Environment Setup</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="fu">### Install Required Packages</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>Install the necessary Python packages for data processing, spatial analysis, and visualization. This includes pandas for data manipulation, geopandas for spatial operations, pygris for accessing Census TIGER/Line shapefiles, and various visualization libraries.</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a><span class="in">``` python</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>conda install <span class="op">-</span>c conda<span class="op">-</span>forge numpy pandas geopandas matplotlib seaborn python<span class="op">-</span>dotenv openpyxl</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install pygris adjustText</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load Libraries</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>Import all required libraries for the analysis. The pygris library enables direct access to Census Bureau geographic data and ACS estimates through their API.</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="co"># For Analysis</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="co"># For Visualization</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> adjustText <span class="im">import</span> adjust_text</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Census data query libraries &amp; modules</span></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygris <span class="im">import</span> blocks, block_groups, counties, states</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygris.helpers <span class="im">import</span> validate_state, validate_county</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygris.data <span class="im">import</span> get_census</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a><span class="co"># misc</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a><span class="fu">### Environment Variables</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>Set the coordinate reference system for the analysis to NAD83 / UTM zone 12N (EPSG:3566), which is appropriate for Utah. Also validate the state FIPS code for Utah.</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>PROJECT_CRS <span class="op">=</span> <span class="st">"EPSG:3566"</span>  <span class="co"># NAD83 / UTM zone 12N</span></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>STATE_FIPS <span class="op">=</span> validate_state(<span class="st">"UT"</span>)</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>**Need a Census API key?** Get one for free at <span class="co">[</span><span class="ot">census.gov/developers</span><span class="co">](https://api.census.gov/data/key_signup.html)</span>.</span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>Create a <span class="in">`.env`</span> file in the project directory and add your Census API key:</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>```CENSUS_API_KEY=your-key-here```</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>This enables fetching US Census data from the Census API.</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your API key into environment (alternative to .env file)</span></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'CENSUS_API_KEY'</span>] <span class="op">=</span> <span class="st">'your_api_key_here'</span></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a><span class="fu">## Define Helper Functions</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fetch Excel Files from BLS or BTS</span></span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_excel(path, url):</span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a><span class="co">    Download Excel file if it doesn't exist locally.</span></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a><span class="co">    path : str or Path</span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a><span class="co">        Local file path to save the Excel file</span></span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a><span class="co">    url : str</span></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a><span class="co">        URL to download the Excel file from</span></span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to Path object if string</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>    filepath <span class="op">=</span> Path(path)</span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Download file if it doesn't exist</span></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> filepath.exists():</span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>        filepath.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a>        headers <span class="op">=</span> {</span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a>            <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.get(url, headers<span class="op">=</span>headers)</span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a>        filepath.write_bytes(response.content)</span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lookup Tables</span></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### Income Category Lookup</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a>Create a reference table defining the income brackets used in ACS Table B19001. Each bracket has a lower and upper limit, and we calculate midpoints for median estimation. The highest bracket ($200,000+) uses $300,000 as a reasonable midpoint based on income distribution patterns.</span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a>lookup_hhinc <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Income Category"</span>: [</span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HH_LT_10K"</span>, <span class="st">"HH_10_15K"</span>, <span class="st">"HH_15_20K"</span>, <span class="st">"HH_20_25K"</span>, <span class="st">"HH_25_30K"</span>, <span class="st">"HH_30_35K"</span>,</span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HH_35_40K"</span>, <span class="st">"HH_40_45K"</span>, <span class="st">"HH_45_50K"</span>, <span class="st">"HH_50_60K"</span>, <span class="st">"HH_60_75K"</span>,</span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HH_75_100K"</span>, <span class="st">"HH_100_125K"</span>, <span class="st">"HH_125_150K"</span>, <span class="st">"HH_150_200K"</span>, <span class="st">"HH_GT_200K"</span></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lower Limit"</span>: [</span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">15000</span>, <span class="dv">20000</span>, <span class="dv">25000</span>, <span class="dv">30000</span>,</span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>    <span class="dv">35000</span>, <span class="dv">40000</span>, <span class="dv">45000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>,</span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a>    <span class="dv">75000</span>, <span class="dv">100000</span>, <span class="dv">125000</span>, <span class="dv">150000</span>, <span class="dv">200000</span></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Upper Limit"</span>: [</span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a>    <span class="dv">9999</span>, <span class="dv">14999</span>, <span class="dv">19999</span>, <span class="dv">24999</span>, <span class="dv">29999</span>, <span class="dv">34999</span>,</span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a>    <span class="dv">39999</span>, <span class="dv">44999</span>, <span class="dv">49999</span>, <span class="dv">59999</span>, <span class="dv">74999</span>,</span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a>    <span class="dv">99999</span>, <span class="dv">124999</span>, <span class="dv">149999</span>, <span class="dv">199999</span>, np.inf</span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute midpoint and round it</span></span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>lookup_hhinc[<span class="st">'Midpoint'</span>] <span class="op">=</span> (</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a>  (lookup_hhinc[<span class="st">'Lower Limit'</span>] <span class="op">+</span> lookup_hhinc[<span class="st">'Upper Limit'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>()</span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace infinite midpoint (last category) with 300000</span></span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>lookup_hhinc.loc[np.isinf(lookup_hhinc[<span class="st">"Upper Limit"</span>]), <span class="st">"Midpoint"</span>] <span class="op">=</span> <span class="dv">300000</span></span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>lookup_hhinc</span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a><span class="fu">## Raw Data Sources</span></span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a><span class="fu">### Consumer Price Index</span></span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a>The Consumer Price Index (CPI-U-RS) from the Bureau of Labor Statistics provides inflation adjustment factors. This will be useful for comparing income values across different time periods or adjusting historical data to current dollars. The research series (R-CPI-U-RS) is particularly appropriate for longitudinal analysis as it uses consistent methodology throughout the time series.</span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>Download and load the CPI data directly from the BLS website. The data includes annual average CPI values that can be used to adjust income figures for inflation.</span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>Data Source: Consumer Price Index for All Urban Consumers (CPI-U) <span class="sc">\[</span>Source: <span class="co">[</span><span class="ot">Bureau of Labor Statistics</span><span class="co">](https://www.bls.gov/cpi/research-series/r-cpi-u-rs-home.htm)</span><span class="sc">\]</span></span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a>filepath_cpi <span class="op">=</span> Path(<span class="st">"_data/bls/r-cpi-u-rs-allitems.xlsx"</span>)</span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a>url_cpi <span class="op">=</span> <span class="st">"https://www.bls.gov/cpi/research-series/r-cpi-u-rs-allitems.xlsx"</span></span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Download if needed</span></span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>fetch_excel(path<span class="op">=</span>filepath_cpi, url<span class="op">=</span>url_cpi)</span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Read separately</span></span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a>df_CPI <span class="op">=</span> pd.read_excel(</span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a>    filepath_cpi,</span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>    sheet_name<span class="op">=</span><span class="st">"All items"</span>,</span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a>    usecols<span class="op">=</span><span class="st">"A:N"</span>,</span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a>    skiprows<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a>    engine<span class="op">=</span><span class="st">'openpyxl'</span></span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a>df_CPI</span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-226"><a href="#cb25-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-227"><a href="#cb25-227" aria-hidden="true" tabindex="-1"></a><span class="fu">### American Community Survey (ACS) 5-Year Estimates</span></span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Define Census Variables</span></span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a>Define the specific ACS variables we need for this analysis. Table B19013 provides median household income, while Table B19001 provides the household income distribution across 16 income brackets. These brackets allow us to calculate weighted averages and estimate medians when direct values are unavailable.</span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Define variables to download</span></span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a>acs_variables <span class="op">=</span> {</span>
<span id="cb25-238"><a href="#cb25-238" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19013_001E'</span>: <span class="st">'HH_MED_INC'</span>,  <span class="co"># Median Household Income in the Past 12 Months (in 2023 Inflation-Adjusted Dollars)</span></span>
<span id="cb25-239"><a href="#cb25-239" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19013_001M'</span>: <span class="st">'HH_MED_INC_MOE'</span>,  <span class="co"># Margin of Error for Median Household Income</span></span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_001E'</span>: <span class="st">'HH_TOTAL'</span>,  <span class="co"># Total Households</span></span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_002E'</span>: <span class="st">'HH_LT_10K'</span>,  <span class="co"># Less than $10,000</span></span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_003E'</span>: <span class="st">'HH_10_15K'</span>,  <span class="co"># $10,000 to $14,999</span></span>
<span id="cb25-243"><a href="#cb25-243" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_004E'</span>: <span class="st">'HH_15_20K'</span>,  <span class="co"># $15,000 to $19,999</span></span>
<span id="cb25-244"><a href="#cb25-244" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_005E'</span>: <span class="st">'HH_20_25K'</span>,  <span class="co"># $20,000 to $24,999</span></span>
<span id="cb25-245"><a href="#cb25-245" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_006E'</span>: <span class="st">'HH_25_30K'</span>,  <span class="co"># $25,000 to $29,999</span></span>
<span id="cb25-246"><a href="#cb25-246" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_007E'</span>: <span class="st">'HH_30_35K'</span>,  <span class="co"># $30,000 to $34,999</span></span>
<span id="cb25-247"><a href="#cb25-247" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_008E'</span>: <span class="st">'HH_35_40K'</span>,  <span class="co"># $35,000 to $39,999</span></span>
<span id="cb25-248"><a href="#cb25-248" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_009E'</span>: <span class="st">'HH_40_45K'</span>,  <span class="co"># $40,000 to $44,999</span></span>
<span id="cb25-249"><a href="#cb25-249" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_010E'</span>: <span class="st">'HH_45_50K'</span>,  <span class="co"># $45,000 to $49,999</span></span>
<span id="cb25-250"><a href="#cb25-250" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_011E'</span>: <span class="st">'HH_50_60K'</span>,  <span class="co"># $50,000 to $59,999</span></span>
<span id="cb25-251"><a href="#cb25-251" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_012E'</span>: <span class="st">'HH_60_75K'</span>,  <span class="co"># $60,000 to $74,999</span></span>
<span id="cb25-252"><a href="#cb25-252" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_013E'</span>: <span class="st">'HH_75_100K'</span>,  <span class="co"># $75,000 to $99,999</span></span>
<span id="cb25-253"><a href="#cb25-253" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_014E'</span>: <span class="st">'HH_100_125K'</span>,  <span class="co"># $100,000 to $124,999</span></span>
<span id="cb25-254"><a href="#cb25-254" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_015E'</span>: <span class="st">'HH_125_150K'</span>,  <span class="co"># $125,000 to $149,999</span></span>
<span id="cb25-255"><a href="#cb25-255" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_016E'</span>: <span class="st">'HH_150_200K'</span>,  <span class="co"># $150,000 to $199,999</span></span>
<span id="cb25-256"><a href="#cb25-256" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B19001_017E'</span>: <span class="st">'HH_GT_200K'</span>  <span class="co"># $200,000 or more</span></span>
<span id="cb25-257"><a href="#cb25-257" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-258"><a href="#cb25-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-259"><a href="#cb25-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-260"><a href="#cb25-260" aria-hidden="true" tabindex="-1"></a><span class="fu">#### State Level Data</span></span>
<span id="cb25-261"><a href="#cb25-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-262"><a href="#cb25-262" aria-hidden="true" tabindex="-1"></a>Retrieve state-level income data for Utah. While we'll primarily use smaller geographies, state-level data provides a useful benchmark for comparison and validation.</span>
<span id="cb25-263"><a href="#cb25-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-266"><a href="#cb25-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-267"><a href="#cb25-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch state boundaries from TIGER/Line shapefiles</span></span>
<span id="cb25-268"><a href="#cb25-268" aria-hidden="true" tabindex="-1"></a>gdf_ut_bound <span class="op">=</span> states(</span>
<span id="cb25-269"><a href="#cb25-269" aria-hidden="true" tabindex="-1"></a>  year<span class="op">=</span><span class="dv">2023</span>,</span>
<span id="cb25-270"><a href="#cb25-270" aria-hidden="true" tabindex="-1"></a>  cache<span class="op">=</span><span class="va">True</span></span>
<span id="cb25-271"><a href="#cb25-271" aria-hidden="true" tabindex="-1"></a>).to_crs(PROJECT_CRS)</span>
<span id="cb25-272"><a href="#cb25-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-273"><a href="#cb25-273" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Utah only</span></span>
<span id="cb25-274"><a href="#cb25-274" aria-hidden="true" tabindex="-1"></a>gdf_ut_bound <span class="op">=</span> gdf_ut_bound[gdf_ut_bound[<span class="st">'STATEFP'</span>] <span class="op">==</span> <span class="bu">str</span>(STATE_FIPS)]</span>
<span id="cb25-275"><a href="#cb25-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-276"><a href="#cb25-276" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Income data from ACS 5-year estimates for Utah</span></span>
<span id="cb25-277"><a href="#cb25-277" aria-hidden="true" tabindex="-1"></a>df_ut_income <span class="op">=</span> get_census(</span>
<span id="cb25-278"><a href="#cb25-278" aria-hidden="true" tabindex="-1"></a>  dataset<span class="op">=</span><span class="st">"acs/acs5"</span>,</span>
<span id="cb25-279"><a href="#cb25-279" aria-hidden="true" tabindex="-1"></a>  year<span class="op">=</span><span class="dv">2023</span>,</span>
<span id="cb25-280"><a href="#cb25-280" aria-hidden="true" tabindex="-1"></a>  variables<span class="op">=</span><span class="bu">list</span>(acs_variables.keys()),</span>
<span id="cb25-281"><a href="#cb25-281" aria-hidden="true" tabindex="-1"></a>  params<span class="op">=</span>{</span>
<span id="cb25-282"><a href="#cb25-282" aria-hidden="true" tabindex="-1"></a>      <span class="co"># "key": f"{os.getenv('CENSUS_API_KEY')}", # </span><span class="al">FIXME</span><span class="co">: This causes error</span></span>
<span id="cb25-283"><a href="#cb25-283" aria-hidden="true" tabindex="-1"></a>      <span class="st">"for"</span>: <span class="ss">f"state:</span><span class="sc">{</span>STATE_FIPS<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb25-284"><a href="#cb25-284" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-285"><a href="#cb25-285" aria-hidden="true" tabindex="-1"></a>    return_geoid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-286"><a href="#cb25-286" aria-hidden="true" tabindex="-1"></a>    guess_dtypes<span class="op">=</span><span class="va">True</span></span>
<span id="cb25-287"><a href="#cb25-287" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-288"><a href="#cb25-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-289"><a href="#cb25-289" aria-hidden="true" tabindex="-1"></a><span class="co"># Join ACS data to block group boundaries and transform CRS</span></span>
<span id="cb25-290"><a href="#cb25-290" aria-hidden="true" tabindex="-1"></a>gdf_ut_income <span class="op">=</span> gdf_ut_bound[[<span class="st">'GEOID'</span>, <span class="st">'STATEFP'</span>, <span class="st">'NAME'</span>, <span class="st">'geometry'</span>]].merge(</span>
<span id="cb25-291"><a href="#cb25-291" aria-hidden="true" tabindex="-1"></a>    df_ut_income, on <span class="op">=</span> <span class="st">"GEOID"</span></span>
<span id="cb25-292"><a href="#cb25-292" aria-hidden="true" tabindex="-1"></a>).to_crs(PROJECT_CRS).rename(columns<span class="op">=</span>acs_variables)</span>
<span id="cb25-293"><a href="#cb25-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-294"><a href="#cb25-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview data</span></span>
<span id="cb25-295"><a href="#cb25-295" aria-hidden="true" tabindex="-1"></a>gdf_ut_income</span>
<span id="cb25-296"><a href="#cb25-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-297"><a href="#cb25-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-298"><a href="#cb25-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## Intermediate Calculations</span></span>
<span id="cb25-299"><a href="#cb25-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-300"><a href="#cb25-300" aria-hidden="true" tabindex="-1"></a><span class="fu">### Income Groupings (Approximate Income Quartiles)</span></span>
<span id="cb25-301"><a href="#cb25-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-304"><a href="#cb25-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-305"><a href="#cb25-305" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of lookup table to work with</span></span>
<span id="cb25-306"><a href="#cb25-306" aria-hidden="true" tabindex="-1"></a>df_inc_group <span class="op">=</span> lookup_hhinc.copy()</span>
<span id="cb25-307"><a href="#cb25-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-308"><a href="#cb25-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the income category columns from gdf_ut_income</span></span>
<span id="cb25-309"><a href="#cb25-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract just the income bracket counts (excluding totals and medians)</span></span>
<span id="cb25-310"><a href="#cb25-310" aria-hidden="true" tabindex="-1"></a>income_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> gdf_ut_income.columns <span class="cf">if</span> col.startswith(<span class="st">'HH_'</span>)</span>
<span id="cb25-311"><a href="#cb25-311" aria-hidden="true" tabindex="-1"></a>               <span class="kw">and</span> col <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'HH_TOTAL'</span>, <span class="st">'HH_MED_INC'</span>, <span class="st">'HH_MED_INC_MOE'</span>]]</span>
<span id="cb25-312"><a href="#cb25-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-313"><a href="#cb25-313" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping between lookup categories and gdf_ut_income columns</span></span>
<span id="cb25-314"><a href="#cb25-314" aria-hidden="true" tabindex="-1"></a><span class="co"># They should already match, but let's be explicit</span></span>
<span id="cb25-315"><a href="#cb25-315" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'State HH'</span>] <span class="op">=</span> df_inc_group[<span class="st">'Income Category'</span>].<span class="bu">map</span>(</span>
<span id="cb25-316"><a href="#cb25-316" aria-hidden="true" tabindex="-1"></a>    gdf_ut_income[income_cols].iloc[<span class="dv">0</span>].to_dict()</span>
<span id="cb25-317"><a href="#cb25-317" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-318"><a href="#cb25-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-319"><a href="#cb25-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage of households</span></span>
<span id="cb25-320"><a href="#cb25-320" aria-hidden="true" tabindex="-1"></a>total_hh <span class="op">=</span> df_inc_group[<span class="st">'State HH'</span>].<span class="bu">sum</span>()</span>
<span id="cb25-321"><a href="#cb25-321" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'% HH'</span>] <span class="op">=</span> (df_inc_group[<span class="st">'State HH'</span>] <span class="op">/</span> total_hh <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb25-322"><a href="#cb25-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-323"><a href="#cb25-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative percentage</span></span>
<span id="cb25-324"><a href="#cb25-324" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'Cum % HH'</span>] <span class="op">=</span> df_inc_group[<span class="st">'% HH'</span>].cumsum().<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb25-325"><a href="#cb25-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-326"><a href="#cb25-326" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign income groups based on quartiles (25%, 50%, 75%, 100%)</span></span>
<span id="cb25-327"><a href="#cb25-327" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'Inc Group'</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb25-328"><a href="#cb25-328" aria-hidden="true" tabindex="-1"></a>    df_inc_group[<span class="st">'Cum % HH'</span>],</span>
<span id="cb25-329"><a href="#cb25-329" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>],</span>
<span id="cb25-330"><a href="#cb25-330" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Inc Group 1'</span>, <span class="st">'Inc Group 2'</span>, <span class="st">'Inc Group 3'</span>, <span class="st">'Inc Group 4'</span>],</span>
<span id="cb25-331"><a href="#cb25-331" aria-hidden="true" tabindex="-1"></a>    include_lowest<span class="op">=</span><span class="va">True</span></span>
<span id="cb25-332"><a href="#cb25-332" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-333"><a href="#cb25-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-334"><a href="#cb25-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate HH_MedInc_Product (HH * Midpoint)</span></span>
<span id="cb25-335"><a href="#cb25-335" aria-hidden="true" tabindex="-1"></a>df_inc_group[<span class="st">'HH_MedInc_Product'</span>] <span class="op">=</span> df_inc_group[<span class="st">'State HH'</span>] <span class="op">*</span> df_inc_group[<span class="st">'Midpoint'</span>]</span>
<span id="cb25-336"><a href="#cb25-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-337"><a href="#cb25-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the dataframe</span></span>
<span id="cb25-338"><a href="#cb25-338" aria-hidden="true" tabindex="-1"></a>df_inc_group</span>
<span id="cb25-339"><a href="#cb25-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-340"><a href="#cb25-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-341"><a href="#cb25-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-344"><a href="#cb25-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-345"><a href="#cb25-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Household Income Distribution by Quartile"</span></span>
<span id="cb25-346"><a href="#cb25-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-347"><a href="#cb25-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for seaborn</span></span>
<span id="cb25-348"><a href="#cb25-348" aria-hidden="true" tabindex="-1"></a>df_plot <span class="op">=</span> df_inc_group.copy()</span>
<span id="cb25-349"><a href="#cb25-349" aria-hidden="true" tabindex="-1"></a>df_plot[<span class="st">'Income Label'</span>] <span class="op">=</span> df_plot[<span class="st">'Income Category'</span>].<span class="bu">str</span>.replace(<span class="st">'HH_'</span>, <span class="st">''</span>).<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb25-350"><a href="#cb25-350" aria-hidden="true" tabindex="-1"></a>df_plot[<span class="st">'index'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(df_plot))</span>
<span id="cb25-351"><a href="#cb25-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-352"><a href="#cb25-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for each income group</span></span>
<span id="cb25-353"><a href="#cb25-353" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">'Inc Group 1'</span>: <span class="st">'#3498db'</span>, <span class="st">'Inc Group 2'</span>: <span class="st">'#2ecc71'</span>,</span>
<span id="cb25-354"><a href="#cb25-354" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Inc Group 3'</span>: <span class="st">'#f39c12'</span>, <span class="st">'Inc Group 4'</span>: <span class="st">'#e74c3c'</span>}</span>
<span id="cb25-355"><a href="#cb25-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-356"><a href="#cb25-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seaborn style and context</span></span>
<span id="cb25-357"><a href="#cb25-357" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb25-358"><a href="#cb25-358" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"notebook"</span>)</span>
<span id="cb25-359"><a href="#cb25-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-360"><a href="#cb25-360" aria-hidden="true" tabindex="-1"></a><span class="co"># Create barplot using seaborn</span></span>
<span id="cb25-361"><a href="#cb25-361" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb25-362"><a href="#cb25-362" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb25-363"><a href="#cb25-363" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_plot,</span>
<span id="cb25-364"><a href="#cb25-364" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'index'</span>,</span>
<span id="cb25-365"><a href="#cb25-365" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'State HH'</span>,</span>
<span id="cb25-366"><a href="#cb25-366" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Inc Group'</span>,</span>
<span id="cb25-367"><a href="#cb25-367" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>palette,</span>
<span id="cb25-368"><a href="#cb25-368" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-369"><a href="#cb25-369" aria-hidden="true" tabindex="-1"></a>    dodge<span class="op">=</span><span class="va">False</span></span>
<span id="cb25-370"><a href="#cb25-370" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-371"><a href="#cb25-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-372"><a href="#cb25-372" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb25-373"><a href="#cb25-373" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Income Category'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb25-374"><a href="#cb25-374" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Households'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb25-375"><a href="#cb25-375" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Utah Household Income Distribution by Quartile'</span>,</span>
<span id="cb25-376"><a href="#cb25-376" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb25-377"><a href="#cb25-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-378"><a href="#cb25-378" aria-hidden="true" tabindex="-1"></a><span class="co"># Format y-axis with comma separator</span></span>
<span id="cb25-379"><a href="#cb25-379" aria-hidden="true" tabindex="-1"></a>plt.gca().yaxis.set_major_formatter(ticker.FuncFormatter(<span class="kw">lambda</span> x, p: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span>))</span>
<span id="cb25-380"><a href="#cb25-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-381"><a href="#cb25-381" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis labels</span></span>
<span id="cb25-382"><a href="#cb25-382" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(df_plot)), df_plot[<span class="st">'Income Label'</span>],</span>
<span id="cb25-383"><a href="#cb25-383" aria-hidden="true" tabindex="-1"></a>           rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb25-384"><a href="#cb25-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-385"><a href="#cb25-385" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize legend</span></span>
<span id="cb25-386"><a href="#cb25-386" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, frameon<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">10</span>, title<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb25-387"><a href="#cb25-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-388"><a href="#cb25-388" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid styling</span></span>
<span id="cb25-389"><a href="#cb25-389" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb25-390"><a href="#cb25-390" aria-hidden="true" tabindex="-1"></a>plt.gca().set_axisbelow(<span class="va">True</span>)</span>
<span id="cb25-391"><a href="#cb25-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-392"><a href="#cb25-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for cleaner look</span></span>
<span id="cb25-393"><a href="#cb25-393" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb25-394"><a href="#cb25-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-395"><a href="#cb25-395" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb25-396"><a href="#cb25-396" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb25-397"><a href="#cb25-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-398"><a href="#cb25-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-399"><a href="#cb25-399" aria-hidden="true" tabindex="-1"></a><span class="fu">### Median Income (in Model Base Year Dollars)</span></span>
<span id="cb25-400"><a href="#cb25-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-403"><a href="#cb25-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-404"><a href="#cb25-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Define income categories</span></span>
<span id="cb25-405"><a href="#cb25-405" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> {</span>
<span id="cb25-406"><a href="#cb25-406" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Average'</span>: df_inc_group,</span>
<span id="cb25-407"><a href="#cb25-407" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Low Inc'</span>: df_inc_group[df_inc_group[<span class="st">'Inc Group'</span>] <span class="op">==</span> <span class="st">'Inc Group 1'</span>],</span>
<span id="cb25-408"><a href="#cb25-408" aria-hidden="true" tabindex="-1"></a>    <span class="st">'High Inc'</span>: df_inc_group[df_inc_group[<span class="st">'Inc Group'</span>] <span class="op">!=</span> <span class="st">'Inc Group 1'</span>]</span>
<span id="cb25-409"><a href="#cb25-409" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-410"><a href="#cb25-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-411"><a href="#cb25-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics for each category</span></span>
<span id="cb25-412"><a href="#cb25-412" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> {}</span>
<span id="cb25-413"><a href="#cb25-413" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_name, cat_df <span class="kw">in</span> categories.items():</span>
<span id="cb25-414"><a href="#cb25-414" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name] <span class="op">=</span> {</span>
<span id="cb25-415"><a href="#cb25-415" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Sum HH'</span>: cat_df[<span class="st">'State HH'</span>].<span class="bu">sum</span>(),</span>
<span id="cb25-416"><a href="#cb25-416" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Sum HH * Inc'</span>: cat_df[<span class="st">'HH_MedInc_Product'</span>].<span class="bu">sum</span>(),</span>
<span id="cb25-417"><a href="#cb25-417" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-418"><a href="#cb25-418" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate unadjusted median income</span></span>
<span id="cb25-419"><a href="#cb25-419" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name][<span class="st">'Unadj Med Inc'</span>] <span class="op">=</span> (</span>
<span id="cb25-420"><a href="#cb25-420" aria-hidden="true" tabindex="-1"></a>        summary_data[cat_name][<span class="st">'Sum HH * Inc'</span>] <span class="op">/</span> summary_data[cat_name][<span class="st">'Sum HH'</span>]</span>
<span id="cb25-421"><a href="#cb25-421" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-422"><a href="#cb25-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-423"><a href="#cb25-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correction factor from Average category</span></span>
<span id="cb25-424"><a href="#cb25-424" aria-hidden="true" tabindex="-1"></a>actual_median_income <span class="op">=</span> gdf_ut_income[<span class="st">'HH_MED_INC'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb25-425"><a href="#cb25-425" aria-hidden="true" tabindex="-1"></a>correction_factor <span class="op">=</span> actual_median_income <span class="op">/</span> summary_data[<span class="st">'Average'</span>][<span class="st">'Unadj Med Inc'</span>]</span>
<span id="cb25-426"><a href="#cb25-426" aria-hidden="true" tabindex="-1"></a>inflation_factor <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb25-427"><a href="#cb25-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-428"><a href="#cb25-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply correction and inflation factors</span></span>
<span id="cb25-429"><a href="#cb25-429" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_name <span class="kw">in</span> summary_data:</span>
<span id="cb25-430"><a href="#cb25-430" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summary_data[cat_name]['Correction Factor'] = correction_factor</span></span>
<span id="cb25-431"><a href="#cb25-431" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name][<span class="st">'Adj Med Income'</span>] <span class="op">=</span> (</span>
<span id="cb25-432"><a href="#cb25-432" aria-hidden="true" tabindex="-1"></a>        summary_data[cat_name][<span class="st">'Unadj Med Inc'</span>] <span class="op">*</span> correction_factor</span>
<span id="cb25-433"><a href="#cb25-433" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-434"><a href="#cb25-434" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summary_data[cat_name]['Inflation Adj Factor'] = inflation_factor</span></span>
<span id="cb25-435"><a href="#cb25-435" aria-hidden="true" tabindex="-1"></a>    summary_data[cat_name][<span class="st">'Median Income'</span>] <span class="op">=</span> (</span>
<span id="cb25-436"><a href="#cb25-436" aria-hidden="true" tabindex="-1"></a>        summary_data[cat_name][<span class="st">'Adj Med Income'</span>] <span class="op">*</span> inflation_factor</span>
<span id="cb25-437"><a href="#cb25-437" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-438"><a href="#cb25-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-439"><a href="#cb25-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb25-440"><a href="#cb25-440" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> pd.DataFrame(summary_data).T</span>
<span id="cb25-441"><a href="#cb25-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-442"><a href="#cb25-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for display</span></span>
<span id="cb25-443"><a href="#cb25-443" aria-hidden="true" tabindex="-1"></a>format_specs <span class="op">=</span> {</span>
<span id="cb25-444"><a href="#cb25-444" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sum HH'</span>: <span class="st">'</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb25-445"><a href="#cb25-445" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sum HH * Inc'</span>: <span class="st">'</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb25-446"><a href="#cb25-446" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Unadj Med Inc'</span>: <span class="st">'$</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb25-447"><a href="#cb25-447" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 'Correction Factor': '{:.4f}',</span></span>
<span id="cb25-448"><a href="#cb25-448" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Adj Med Income'</span>: <span class="st">'$</span><span class="sc">{:,.0f}</span><span class="st">'</span>,</span>
<span id="cb25-449"><a href="#cb25-449" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 'Inflation Adj Factor': '{:.4f}',</span></span>
<span id="cb25-450"><a href="#cb25-450" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Median Income'</span>: <span class="st">'$</span><span class="sc">{:,.0f}</span><span class="st">'</span></span>
<span id="cb25-451"><a href="#cb25-451" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-452"><a href="#cb25-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-453"><a href="#cb25-453" aria-hidden="true" tabindex="-1"></a>df_median_income <span class="op">=</span> df_summary.copy()</span>
<span id="cb25-454"><a href="#cb25-454" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, fmt <span class="kw">in</span> format_specs.items():</span>
<span id="cb25-455"><a href="#cb25-455" aria-hidden="true" tabindex="-1"></a>    df_median_income[col] <span class="op">=</span> df_summary[col].<span class="bu">apply</span>(<span class="kw">lambda</span> x: fmt.<span class="bu">format</span>(x))</span>
<span id="cb25-456"><a href="#cb25-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-457"><a href="#cb25-457" aria-hidden="true" tabindex="-1"></a>df_median_income</span>
<span id="cb25-458"><a href="#cb25-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-459"><a href="#cb25-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-460"><a href="#cb25-460" aria-hidden="true" tabindex="-1"></a><span class="fu">### Value of Time (in Model Base Year Dollars)</span></span>
<span id="cb25-461"><a href="#cb25-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-462"><a href="#cb25-462" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Calculate Hourly Income</span></span>
<span id="cb25-463"><a href="#cb25-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-466"><a href="#cb25-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-467"><a href="#cb25-467" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract median incomes and calculate hourly rates</span></span>
<span id="cb25-468"><a href="#cb25-468" aria-hidden="true" tabindex="-1"></a>median_income <span class="op">=</span> df_summary.loc[[<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>], <span class="st">'Median Income'</span>]</span>
<span id="cb25-469"><a href="#cb25-469" aria-hidden="true" tabindex="-1"></a>median_income_hr <span class="op">=</span> median_income <span class="op">/</span> <span class="dv">2080</span></span>
<span id="cb25-470"><a href="#cb25-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-471"><a href="#cb25-471" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb25-472"><a href="#cb25-472" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"HOURLY INCOME &amp; ESTIMATED WAGE RATE"</span>)</span>
<span id="cb25-473"><a href="#cb25-473" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb25-474"><a href="#cb25-474" aria-hidden="true" tabindex="-1"></a>df_hourly_display <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-475"><a href="#cb25-475" aria-hidden="true" tabindex="-1"></a>    cat: [<span class="ss">f"$</span><span class="sc">{</span>median_income[cat]<span class="sc">:,.0f}</span><span class="ss">"</span>, <span class="ss">f"$</span><span class="sc">{</span>median_income_hr[cat]<span class="sc">:.2f}</span><span class="ss">"</span>]</span>
<span id="cb25-476"><a href="#cb25-476" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]</span>
<span id="cb25-477"><a href="#cb25-477" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">'Median Income'</span>, <span class="st">'Median Income ($/hr)'</span>])</span>
<span id="cb25-478"><a href="#cb25-478" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_hourly_display.to_string())</span>
<span id="cb25-479"><a href="#cb25-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-480"><a href="#cb25-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-481"><a href="#cb25-481" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Setup VOT Calculation Helper</span></span>
<span id="cb25-482"><a href="#cb25-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-485"><a href="#cb25-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-486"><a href="#cb25-486" aria-hidden="true" tabindex="-1"></a><span class="co"># Hardcoded VOT percentages from previous calculations</span></span>
<span id="cb25-487"><a href="#cb25-487" aria-hidden="true" tabindex="-1"></a>vot_percentages <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-488"><a href="#cb25-488" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Work'</span>: [<span class="fl">0.39</span>, <span class="fl">0.62</span>, <span class="fl">0.34</span>],</span>
<span id="cb25-489"><a href="#cb25-489" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Personal'</span>: [<span class="fl">0.30</span>, <span class="fl">0.49</span>, <span class="fl">0.27</span>]</span>
<span id="cb25-490"><a href="#cb25-490" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>])</span>
<span id="cb25-491"><a href="#cb25-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-492"><a href="#cb25-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to calculate VOT metrics</span></span>
<span id="cb25-493"><a href="#cb25-493" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_vot(hourly_rate, percentage):</span>
<span id="cb25-494"><a href="#cb25-494" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate VOT metrics: unrounded rate, VOT cents/min, equivalent rate"""</span></span>
<span id="cb25-495"><a href="#cb25-495" aria-hidden="true" tabindex="-1"></a>    unrounded_hr <span class="op">=</span> hourly_rate <span class="op">*</span> percentage</span>
<span id="cb25-496"><a href="#cb25-496" aria-hidden="true" tabindex="-1"></a>    vot_cents <span class="op">=</span> <span class="bu">round</span>(unrounded_hr <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="dv">60</span>, <span class="dv">0</span>)</span>
<span id="cb25-497"><a href="#cb25-497" aria-hidden="true" tabindex="-1"></a>    equiv_hr <span class="op">=</span> vot_cents <span class="op">*</span> <span class="dv">60</span> <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb25-498"><a href="#cb25-498" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unrounded_hr, vot_cents, equiv_hr</span>
<span id="cb25-499"><a href="#cb25-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-500"><a href="#cb25-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-501"><a href="#cb25-501" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Calculate and Display Work &amp; Personal VOT</span></span>
<span id="cb25-502"><a href="#cb25-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-505"><a href="#cb25-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-506"><a href="#cb25-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate all VOT metrics</span></span>
<span id="cb25-507"><a href="#cb25-507" aria-hidden="true" tabindex="-1"></a>vot_results <span class="op">=</span> {}</span>
<span id="cb25-508"><a href="#cb25-508" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip_type <span class="kw">in</span> [<span class="st">'Work'</span>, <span class="st">'Personal'</span>]:</span>
<span id="cb25-509"><a href="#cb25-509" aria-hidden="true" tabindex="-1"></a>    vot_results[trip_type] <span class="op">=</span> {}</span>
<span id="cb25-510"><a href="#cb25-510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> income_cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]:</span>
<span id="cb25-511"><a href="#cb25-511" aria-hidden="true" tabindex="-1"></a>        pct <span class="op">=</span> vot_percentages.loc[income_cat, trip_type]</span>
<span id="cb25-512"><a href="#cb25-512" aria-hidden="true" tabindex="-1"></a>        vot_results[trip_type][income_cat] <span class="op">=</span> calculate_vot(median_income_hr[income_cat], pct)</span>
<span id="cb25-513"><a href="#cb25-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-514"><a href="#cb25-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Display Work &amp; Personal VOT</span></span>
<span id="cb25-515"><a href="#cb25-515" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb25-516"><a href="#cb25-516" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"WORK &amp; PERSONAL VALUE OF TIME"</span>)</span>
<span id="cb25-517"><a href="#cb25-517" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb25-518"><a href="#cb25-518" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb25-519"><a href="#cb25-519" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip_type <span class="kw">in</span> [<span class="st">'Work'</span>, <span class="st">'Personal'</span>]:</span>
<span id="cb25-520"><a href="#cb25-520" aria-hidden="true" tabindex="-1"></a>    rows.extend([</span>
<span id="cb25-521"><a href="#cb25-521" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'% of Med Income - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb25-522"><a href="#cb25-522" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"</span><span class="sc">{</span>vot_percentages<span class="sc">.</span>loc[cat, trip_type]<span class="sc">:.0%}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}},</span>
<span id="cb25-523"><a href="#cb25-523" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'Unrounded Hr Rate - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss"> ($/hr)'</span>,</span>
<span id="cb25-524"><a href="#cb25-524" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"$</span><span class="sc">{</span>vot_results[trip_type][cat][<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}},</span>
<span id="cb25-525"><a href="#cb25-525" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'Value of Time - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss"> (cent/min)'</span>,</span>
<span id="cb25-526"><a href="#cb25-526" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"</span><span class="sc">{</span>vot_results[trip_type][cat][<span class="dv">1</span>]<span class="sc">:.0f}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}},</span>
<span id="cb25-527"><a href="#cb25-527" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'Metric'</span>: <span class="ss">f'Equiv Hr Rate - </span><span class="sc">{</span>trip_type<span class="sc">}</span><span class="ss"> ($/hr)'</span>,</span>
<span id="cb25-528"><a href="#cb25-528" aria-hidden="true" tabindex="-1"></a>         <span class="op">**</span>{cat: <span class="ss">f"$</span><span class="sc">{</span>vot_results[trip_type][cat][<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> [<span class="st">'Average'</span>, <span class="st">'Low Inc'</span>, <span class="st">'High Inc'</span>]}}</span>
<span id="cb25-529"><a href="#cb25-529" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb25-530"><a href="#cb25-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> trip_type <span class="op">==</span> <span class="st">'Work'</span>:</span>
<span id="cb25-531"><a href="#cb25-531" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">'Metric'</span>: <span class="st">''</span>, <span class="st">'Average'</span>: <span class="st">''</span>, <span class="st">'Low Inc'</span>: <span class="st">''</span>, <span class="st">'High Inc'</span>: <span class="st">''</span>})</span>
<span id="cb25-532"><a href="#cb25-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-533"><a href="#cb25-533" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(rows).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb25-534"><a href="#cb25-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-535"><a href="#cb25-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-536"><a href="#cb25-536" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Calculate and Display Truck VOT</span></span>
<span id="cb25-537"><a href="#cb25-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-540"><a href="#cb25-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-541"><a href="#cb25-541" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Truck VOT</span></span>
<span id="cb25-542"><a href="#cb25-542" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb25-543"><a href="#cb25-543" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TRUCK VALUE OF TIME"</span>)</span>
<span id="cb25-544"><a href="#cb25-544" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb25-545"><a href="#cb25-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-546"><a href="#cb25-546" aria-hidden="true" tabindex="-1"></a>truck_config <span class="op">=</span> [(<span class="st">'Light'</span>, <span class="fl">0.65</span>), (<span class="st">'Medium'</span>, <span class="fl">0.87</span>), (<span class="st">'Heavy'</span>, <span class="fl">1.10</span>)]</span>
<span id="cb25-547"><a href="#cb25-547" aria-hidden="true" tabindex="-1"></a>truck_rows <span class="op">=</span> []</span>
<span id="cb25-548"><a href="#cb25-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-549"><a href="#cb25-549" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> truck_type, pct <span class="kw">in</span> truck_config:</span>
<span id="cb25-550"><a href="#cb25-550" aria-hidden="true" tabindex="-1"></a>    unrounded, vot, equiv <span class="op">=</span> calculate_vot(median_income_hr[<span class="st">'Average'</span>], pct)</span>
<span id="cb25-551"><a href="#cb25-551" aria-hidden="true" tabindex="-1"></a>    truck_rows.append({</span>
<span id="cb25-552"><a href="#cb25-552" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Type'</span>: truck_type,</span>
<span id="cb25-553"><a href="#cb25-553" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="sc">% o</span><span class="st">f Inc'</span>: <span class="ss">f"</span><span class="sc">{</span>pct<span class="sc">:.0%}</span><span class="ss">"</span>,</span>
<span id="cb25-554"><a href="#cb25-554" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Hr Rate ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>unrounded<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb25-555"><a href="#cb25-555" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: <span class="ss">f"</span><span class="sc">{</span>vot<span class="sc">:.0f}</span><span class="ss">"</span>,</span>
<span id="cb25-556"><a href="#cb25-556" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Equiv Hr Rate ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>equiv<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb25-557"><a href="#cb25-557" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-558"><a href="#cb25-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-559"><a href="#cb25-559" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(truck_rows).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb25-560"><a href="#cb25-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-561"><a href="#cb25-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-562"><a href="#cb25-562" aria-hidden="true" tabindex="-1"></a><span class="fu">## Export Results</span></span>
<span id="cb25-563"><a href="#cb25-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-564"><a href="#cb25-564" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create Final VOT Table</span></span>
<span id="cb25-565"><a href="#cb25-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-568"><a href="#cb25-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-569"><a href="#cb25-569" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract VOT summary table</span></span>
<span id="cb25-570"><a href="#cb25-570" aria-hidden="true" tabindex="-1"></a>vot_summary <span class="op">=</span> []</span>
<span id="cb25-571"><a href="#cb25-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-572"><a href="#cb25-572" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Work and Personal - Average</span></span>
<span id="cb25-573"><a href="#cb25-573" aria-hidden="true" tabindex="-1"></a>vot_summary.extend([</span>
<span id="cb25-574"><a href="#cb25-574" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-575"><a href="#cb25-575" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Wrk'</span>,</span>
<span id="cb25-576"><a href="#cb25-576" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>],</span>
<span id="cb25-577"><a href="#cb25-577" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-578"><a href="#cb25-578" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-579"><a href="#cb25-579" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-580"><a href="#cb25-580" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Per'</span>,</span>
<span id="cb25-581"><a href="#cb25-581" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>],</span>
<span id="cb25-582"><a href="#cb25-582" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-583"><a href="#cb25-583" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-584"><a href="#cb25-584" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-585"><a href="#cb25-585" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Ext'</span>,</span>
<span id="cb25-586"><a href="#cb25-586" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: <span class="bu">round</span>((vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>] <span class="op">+</span> vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span>),</span>
<span id="cb25-587"><a href="#cb25-587" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>(vot_results[<span class="st">'Work'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>] <span class="op">+</span> vot_results[<span class="st">'Personal'</span>][<span class="st">'Average'</span>][<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span><span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-588"><a href="#cb25-588" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-589"><a href="#cb25-589" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-590"><a href="#cb25-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-591"><a href="#cb25-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Truck VOT</span></span>
<span id="cb25-592"><a href="#cb25-592" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> truck_type, pct <span class="kw">in</span> [(<span class="st">'LT'</span>, <span class="fl">0.65</span>), (<span class="st">'MD'</span>, <span class="fl">0.87</span>), (<span class="st">'HV'</span>, <span class="fl">1.10</span>)]:</span>
<span id="cb25-593"><a href="#cb25-593" aria-hidden="true" tabindex="-1"></a>    _, vot, equiv <span class="op">=</span> calculate_vot(median_income_hr[<span class="st">'Average'</span>], pct)</span>
<span id="cb25-594"><a href="#cb25-594" aria-hidden="true" tabindex="-1"></a>    vot_summary.append({</span>
<span id="cb25-595"><a href="#cb25-595" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="ss">f'VOT_</span><span class="sc">{</span>truck_type<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb25-596"><a href="#cb25-596" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot,</span>
<span id="cb25-597"><a href="#cb25-597" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>equiv<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-598"><a href="#cb25-598" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-599"><a href="#cb25-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-600"><a href="#cb25-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Work and Personal - Low Income</span></span>
<span id="cb25-601"><a href="#cb25-601" aria-hidden="true" tabindex="-1"></a>vot_summary.extend([</span>
<span id="cb25-602"><a href="#cb25-602" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-603"><a href="#cb25-603" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Wrk_Lo'</span>,</span>
<span id="cb25-604"><a href="#cb25-604" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Work'</span>][<span class="st">'Low Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb25-605"><a href="#cb25-605" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Work'</span>][<span class="st">'Low Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-606"><a href="#cb25-606" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-607"><a href="#cb25-607" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-608"><a href="#cb25-608" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Per_Lo'</span>,</span>
<span id="cb25-609"><a href="#cb25-609" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Personal'</span>][<span class="st">'Low Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb25-610"><a href="#cb25-610" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Personal'</span>][<span class="st">'Low Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-611"><a href="#cb25-611" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-612"><a href="#cb25-612" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-613"><a href="#cb25-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-614"><a href="#cb25-614" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Work and Personal - High Income</span></span>
<span id="cb25-615"><a href="#cb25-615" aria-hidden="true" tabindex="-1"></a>vot_summary.extend([</span>
<span id="cb25-616"><a href="#cb25-616" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-617"><a href="#cb25-617" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Wrk_Hi'</span>,</span>
<span id="cb25-618"><a href="#cb25-618" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Work'</span>][<span class="st">'High Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb25-619"><a href="#cb25-619" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Work'</span>][<span class="st">'High Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-620"><a href="#cb25-620" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-621"><a href="#cb25-621" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-622"><a href="#cb25-622" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Parameter'</span>: <span class="st">'VOT_Auto_Per_Hi'</span>,</span>
<span id="cb25-623"><a href="#cb25-623" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT (cent/min)'</span>: vot_results[<span class="st">'Personal'</span>][<span class="st">'High Inc'</span>][<span class="dv">1</span>],</span>
<span id="cb25-624"><a href="#cb25-624" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VOT ($/hr)'</span>: <span class="ss">f"$</span><span class="sc">{</span>vot_results[<span class="st">'Personal'</span>][<span class="st">'High Inc'</span>][<span class="dv">2</span>]<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb25-625"><a href="#cb25-625" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-626"><a href="#cb25-626" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-627"><a href="#cb25-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-628"><a href="#cb25-628" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and display final VOT table</span></span>
<span id="cb25-629"><a href="#cb25-629" aria-hidden="true" tabindex="-1"></a>df_vot_final <span class="op">=</span> pd.DataFrame(vot_summary)</span>
<span id="cb25-630"><a href="#cb25-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-631"><a href="#cb25-631" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb25-632"><a href="#cb25-632" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VALUE OF TIME PARAMETERS"</span>)</span>
<span id="cb25-633"><a href="#cb25-633" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb25-634"><a href="#cb25-634" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_vot_final.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb25-635"><a href="#cb25-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-636"><a href="#cb25-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-637"><a href="#cb25-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### Export to CSV</span></span>
<span id="cb25-638"><a href="#cb25-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-641"><a href="#cb25-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-642"><a href="#cb25-642" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb25-643"><a href="#cb25-643" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> Path(<span class="st">"_output"</span>)</span>
<span id="cb25-644"><a href="#cb25-644" aria-hidden="true" tabindex="-1"></a>output_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-645"><a href="#cb25-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-646"><a href="#cb25-646" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to CSV</span></span>
<span id="cb25-647"><a href="#cb25-647" aria-hidden="true" tabindex="-1"></a>df_vot_final.to_csv(</span>
<span id="cb25-648"><a href="#cb25-648" aria-hidden="true" tabindex="-1"></a>    output_dir <span class="op">/</span> <span class="st">"value_of_time.csv"</span>,</span>
<span id="cb25-649"><a href="#cb25-649" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="va">False</span></span>
<span id="cb25-650"><a href="#cb25-650" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-651"><a href="#cb25-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-652"><a href="#cb25-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-653"><a href="#cb25-653" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Download the output files:"}</span>
<span id="cb25-654"><a href="#cb25-654" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">value_of_time.csv</span><span class="co">](./_output/value_of_time.csv)</span></span>
<span id="cb25-655"><a href="#cb25-655" aria-hidden="true" tabindex="-1"></a>:::</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>